[2018-09-18 17:45:00,003: DEBUG/MainProcess] TaskPool: Apply <function _fast_trace_task at 0x7fadec10d620> (args:('boxing_console.tasks.order_tear_finished_after_boxer_confirmed', '558335a4-e3cd-44bb-8be5-007fe65c1068', {'lang': 'py', 'task': 'boxing_console.tasks.order_tear_finished_after_boxer_confirmed', 'id': '558335a4-e3cd-44bb-8be5-007fe65c1068', 'shadow': None, 'eta': None, 'expires': None, 'group': None, 'retries': 0, 'timelimit': [None, None], 'root_id': '558335a4-e3cd-44bb-8be5-007fe65c1068', 'parent_id': None, 'argsrepr': '()', 'kwargsrepr': '{}', 'origin': 'gen216@7b8d459fb4db', 'reply_to': '26979d60-d808-3d32-bcd7-c6f48a392674', 'correlation_id': '558335a4-e3cd-44bb-8be5-007fe65c1068', 'delivery_info': {'exchange': '', 'routing_key': 'celery', 'priority': 0, 'redelivered': None}}, b'[[], {}, {"callbacks": null, "errbacks": null, "chain": null, "chord": null}]', 'application/json', 'utf-8') kwargs:{})
[2018-09-18 17:45:00,005: WARNING/ForkPoolWorker-4] /usr/local/lib/python3.7/site-packages/django/db/models/fields/__init__.py:1423: RuntimeWarning: DateTimeField CourseOrder.boxer_confirm_time received a naive datetime (2018-09-18 17:40:00.004733) while time zone support is active.
  RuntimeWarning)
[2018-09-18 17:45:00,006: DEBUG/MainProcess] Task accepted: boxing_console.tasks.order_tear_finished_after_boxer_confirmed[558335a4-e3cd-44bb-8be5-007fe65c1068] pid:250
(0.002) SELECT `course_order`.`id`, `course_order`.`pay_order_id`, `course_order`.`boxer_id`, `course_order`.`user_id`, `course_order`.`club_id`, `course_order`.`course_id`, `course_order`.`course_name`, `course_order`.`course_price`, `course_order`.`course_duration`, `course_order`.`course_validity`, `course_order`.`order_number`, `course_order`.`status`, `course_order`.`order_time`, `course_order`.`pay_time`, `course_order`.`confirm_status`, `course_order`.`boxer_confirm_time`, `course_order`.`user_confirm_time`, `course_order`.`finish_time`, `course_order`.`amount`, `course_order`.`insurance_amount`, `course_order`.`refund_record_id`, `course_order`.`is_deleted` FROM `course_order` WHERE (`course_order`.`is_deleted` = 0 AND `course_order`.`boxer_confirm_time` < '2018-09-18 09:40:00.004733' AND `course_order`.`confirm_status` = 2) ORDER BY `course_order`.`order_time` DESC; args=(False, '2018-09-18 09:40:00.004733', 2)
[2018-09-18 17:45:00,008: DEBUG/ForkPoolWorker-4] (0.002) SELECT `course_order`.`id`, `course_order`.`pay_order_id`, `course_order`.`boxer_id`, `course_order`.`user_id`, `course_order`.`club_id`, `course_order`.`course_id`, `course_order`.`course_name`, `course_order`.`course_price`, `course_order`.`course_duration`, `course_order`.`course_validity`, `course_order`.`order_number`, `course_order`.`status`, `course_order`.`order_time`, `course_order`.`pay_time`, `course_order`.`confirm_status`, `course_order`.`boxer_confirm_time`, `course_order`.`user_confirm_time`, `course_order`.`finish_time`, `course_order`.`amount`, `course_order`.`insurance_amount`, `course_order`.`refund_record_id`, `course_order`.`is_deleted` FROM `course_order` WHERE (`course_order`.`is_deleted` = 0 AND `course_order`.`boxer_confirm_time` < '2018-09-18 09:40:00.004733' AND `course_order`.`confirm_status` = 2) ORDER BY `course_order`.`order_time` DESC; args=(False, '2018-09-18 09:40:00.004733', 2)
(0.001) SELECT `course`.`id`, `course`.`boxer_id`, `course`.`course_name`, `course`.`price`, `course`.`duration`, `course`.`validity`, `course`.`club_id`, `course`.`is_open`, `course`.`is_deleted` FROM `course` WHERE `course`.`id` = 15; args=(15,)
[2018-09-18 17:45:00,010: DEBUG/ForkPoolWorker-4] (0.001) SELECT `course`.`id`, `course`.`boxer_id`, `course`.`course_name`, `course`.`price`, `course`.`duration`, `course`.`validity`, `course`.`club_id`, `course`.`is_open`, `course`.`is_deleted` FROM `course` WHERE `course`.`id` = 15; args=(15,)
(0.002) SELECT `pay_order`.`id`, `pay_order`.`user_id`, `pay_order`.`content_type_id`, `pay_order`.`object_id`, `pay_order`.`status`, `pay_order`.`out_trade_no`, `pay_order`.`payment_type`, `pay_order`.`amount`, `pay_order`.`device`, `pay_order`.`order_time`, `pay_order`.`pay_time`, `pay_order`.`finish_time` FROM `pay_order` WHERE `pay_order`.`id` = 67; args=(67,)
[2018-09-18 17:45:00,013: DEBUG/ForkPoolWorker-4] (0.002) SELECT `pay_order`.`id`, `pay_order`.`user_id`, `pay_order`.`content_type_id`, `pay_order`.`object_id`, `pay_order`.`status`, `pay_order`.`out_trade_no`, `pay_order`.`payment_type`, `pay_order`.`amount`, `pay_order`.`device`, `pay_order`.`order_time`, `pay_order`.`pay_time`, `pay_order`.`finish_time` FROM `pay_order` WHERE `pay_order`.`id` = 67; args=(67,)
(0.002) SELECT `course_settle_order`.`id`, `course_settle_order`.`order_id`, `course_settle_order`.`course_id`, `course_settle_order`.`course_order_id`, `course_settle_order`.`created_time`, `course_settle_order`.`settled`, `course_settle_order`.`settled_date`, `course_settle_order`.`settled_amount` FROM `course_settle_order` WHERE (`course_settle_order`.`course_id` = 15 AND `course_settle_order`.`course_order_id` = 36 AND `course_settle_order`.`order_id` = 67); args=(15, 36, 67)
[2018-09-18 17:45:00,017: DEBUG/ForkPoolWorker-4] (0.002) SELECT `course_settle_order`.`id`, `course_settle_order`.`order_id`, `course_settle_order`.`course_id`, `course_settle_order`.`course_order_id`, `course_settle_order`.`created_time`, `course_settle_order`.`settled`, `course_settle_order`.`settled_date`, `course_settle_order`.`settled_amount` FROM `course_settle_order` WHERE (`course_settle_order`.`course_id` = 15 AND `course_settle_order`.`course_order_id` = 36 AND `course_settle_order`.`order_id` = 67); args=(15, 36, 67)
[2018-09-18 17:45:00,023: INFO/MainProcess] Received task: boxing_console.tasks.refund_after_order_overdue[75ade92b-ea02-4457-a94d-ef20d64e4351]  
[2018-09-18 17:45:00,023: DEBUG/MainProcess] TaskPool: Apply <function _fast_trace_task at 0x7fadec10d620> (args:('boxing_console.tasks.refund_after_order_overdue', '75ade92b-ea02-4457-a94d-ef20d64e4351', {'lang': 'py', 'task': 'boxing_console.tasks.refund_after_order_overdue', 'id': '75ade92b-ea02-4457-a94d-ef20d64e4351', 'shadow': None, 'eta': None, 'expires': None, 'group': None, 'retries': 0, 'timelimit': [None, None], 'root_id': '75ade92b-ea02-4457-a94d-ef20d64e4351', 'parent_id': None, 'argsrepr': '()', 'kwargsrepr': '{}', 'origin': 'gen216@7b8d459fb4db', 'reply_to': '26979d60-d808-3d32-bcd7-c6f48a392674', 'correlation_id': '75ade92b-ea02-4457-a94d-ef20d64e4351', 'delivery_info': {'exchange': '', 'routing_key': 'celery', 'priority': 0, 'redelivered': None}}, b'[[], {}, {"callbacks": null, "errbacks": null, "chain": null, "chord": null}]', 'application/json', 'utf-8') kwargs:{})
[2018-09-18 17:45:00,024: DEBUG/MainProcess] Task accepted: boxing_console.tasks.refund_after_order_overdue[75ade92b-ea02-4457-a94d-ef20d64e4351] pid:249
(0.001) SELECT `course`.`id`, `course`.`boxer_id`, `course`.`course_name`, `course`.`price`, `course`.`duration`, `course`.`validity`, `course`.`club_id`, `course`.`is_open`, `course`.`is_deleted` FROM `course` WHERE `course`.`id` = 15; args=(15,)
[2018-09-18 17:45:00,026: DEBUG/ForkPoolWorker-4] (0.001) SELECT `course`.`id`, `course`.`boxer_id`, `course`.`course_name`, `course`.`price`, `course`.`duration`, `course`.`validity`, `course`.`club_id`, `course`.`is_open`, `course`.`is_deleted` FROM `course` WHERE `course`.`id` = 15; args=(15,)
(0.005) SELECT `pay_order`.`id`, `pay_order`.`user_id`, `pay_order`.`content_type_id`, `pay_order`.`object_id`, `pay_order`.`status`, `pay_order`.`out_trade_no`, `pay_order`.`payment_type`, `pay_order`.`amount`, `pay_order`.`device`, `pay_order`.`order_time`, `pay_order`.`pay_time`, `pay_order`.`finish_time` FROM `pay_order` WHERE `pay_order`.`id` = 15; args=(15,)
[2018-09-18 17:45:00,034: DEBUG/ForkPoolWorker-4] (0.005) SELECT `pay_order`.`id`, `pay_order`.`user_id`, `pay_order`.`content_type_id`, `pay_order`.`object_id`, `pay_order`.`status`, `pay_order`.`out_trade_no`, `pay_order`.`payment_type`, `pay_order`.`amount`, `pay_order`.`device`, `pay_order`.`order_time`, `pay_order`.`pay_time`, `pay_order`.`finish_time` FROM `pay_order` WHERE `pay_order`.`id` = 15; args=(15,)
(0.001) SET SESSION TRANSACTION ISOLATION LEVEL READ COMMITTED; args=None
[2018-09-18 17:45:00,036: DEBUG/ForkPoolWorker-3] (0.001) SET SESSION TRANSACTION ISOLATION LEVEL READ COMMITTED; args=None
(0.001) SELECT `course_settle_order`.`id`, `course_settle_order`.`order_id`, `course_settle_order`.`course_id`, `course_settle_order`.`course_order_id`, `course_settle_order`.`created_time`, `course_settle_order`.`settled`, `course_settle_order`.`settled_date`, `course_settle_order`.`settled_amount` FROM `course_settle_order` WHERE (`course_settle_order`.`course_id` = 15 AND `course_settle_order`.`course_order_id` = 8 AND `course_settle_order`.`order_id` = 15); args=(15, 8, 15)
[2018-09-18 17:45:00,042: DEBUG/ForkPoolWorker-4] (0.001) SELECT `course_settle_order`.`id`, `course_settle_order`.`order_id`, `course_settle_order`.`course_id`, `course_settle_order`.`course_order_id`, `course_settle_order`.`created_time`, `course_settle_order`.`settled`, `course_settle_order`.`settled_date`, `course_settle_order`.`settled_amount` FROM `course_settle_order` WHERE (`course_settle_order`.`course_id` = 15 AND `course_settle_order`.`course_order_id` = 8 AND `course_settle_order`.`order_id` = 15); args=(15, 8, 15)
(0.006) SELECT `course_order`.`id`, `course_order`.`pay_order_id`, `course_order`.`boxer_id`, `course_order`.`user_id`, `course_order`.`club_id`, `course_order`.`course_id`, `course_order`.`course_name`, `course_order`.`course_price`, `course_order`.`course_duration`, `course_order`.`course_validity`, `course_order`.`order_number`, `course_order`.`status`, `course_order`.`order_time`, `course_order`.`pay_time`, `course_order`.`confirm_status`, `course_order`.`boxer_confirm_time`, `course_order`.`user_confirm_time`, `course_order`.`finish_time`, `course_order`.`amount`, `course_order`.`insurance_amount`, `course_order`.`refund_record_id`, `course_order`.`is_deleted` FROM `course_order` WHERE (`course_order`.`is_deleted` = 0 AND `course_order`.`course_validity` < '2018-09-18' AND `course_order`.`refund_record_id` IS NULL AND `course_order`.`status` = 5) ORDER BY `course_order`.`order_time` DESC; args=(False, '2018-09-18', 5)
[2018-09-18 17:45:00,043: DEBUG/ForkPoolWorker-3] (0.006) SELECT `course_order`.`id`, `course_order`.`pay_order_id`, `course_order`.`boxer_id`, `course_order`.`user_id`, `course_order`.`club_id`, `course_order`.`course_id`, `course_order`.`course_name`, `course_order`.`course_price`, `course_order`.`course_duration`, `course_order`.`course_validity`, `course_order`.`order_number`, `course_order`.`status`, `course_order`.`order_time`, `course_order`.`pay_time`, `course_order`.`confirm_status`, `course_order`.`boxer_confirm_time`, `course_order`.`user_confirm_time`, `course_order`.`finish_time`, `course_order`.`amount`, `course_order`.`insurance_amount`, `course_order`.`refund_record_id`, `course_order`.`is_deleted` FROM `course_order` WHERE (`course_order`.`is_deleted` = 0 AND `course_order`.`course_validity` < '2018-09-18' AND `course_order`.`refund_record_id` IS NULL AND `course_order`.`status` = 5) ORDER BY `course_order`.`order_time` DESC; args=(False, '2018-09-18', 5)
(0.001) UPDATE `course_order` SET `status` = 3 WHERE (`course_order`.`is_deleted` = 0 AND `course_order`.`boxer_confirm_time` < '2018-09-18 09:40:00.004733' AND `course_order`.`confirm_status` = 2); args=(3, False, '2018-09-18 09:40:00.004733', 2)
[2018-09-18 17:45:00,045: DEBUG/ForkPoolWorker-4] (0.001) UPDATE `course_order` SET `status` = 3 WHERE (`course_order`.`is_deleted` = 0 AND `course_order`.`boxer_confirm_time` < '2018-09-18 09:40:00.004733' AND `course_order`.`confirm_status` = 2); args=(3, False, '2018-09-18 09:40:00.004733', 2)
[2018-09-18 17:45:00,048: INFO/ForkPoolWorker-4] Task boxing_console.tasks.order_tear_finished_after_boxer_confirmed[558335a4-e3cd-44bb-8be5-007fe65c1068] succeeded in 0.04402041000139434s: None
[2018-09-18 17:45:00,053: DEBUG/ForkPoolWorker-3] Sending message of length 2929 to http://39.104.180.65/api/2/store/
[2018-09-18 17:45:00,054: ERROR/ForkPoolWorker-3] Task boxing_console.tasks.refund_after_order_overdue[75ade92b-ea02-4457-a94d-ef20d64e4351] raised unexpected: TypeError("unsupported operand type(s) for -: 'NoneType' and 'int'")
Traceback (most recent call last):
  File "/usr/local/lib/python3.7/site-packages/celery/app/trace.py", line 382, in trace_task
    R = retval = fun(*args, **kwargs)
  File "/usr/local/lib/python3.7/site-packages/celery/app/trace.py", line 641, in __protected_call__
    return self.run(*args, **kwargs)
  File "/work/boxing_console/tasks.py", line 52, in refund_after_order_overdue
    return_amount = course_order.amount - insurance_amount
TypeError: unsupported operand type(s) for -: 'NoneType' and 'int'
[2018-09-18 17:46:00,016: INFO/MainProcess] Received task: boxing_console.tasks.refund_after_order_overdue[cd48a5ea-e6cb-43ff-a855-a24fc24ee5dd]  
[2018-09-18 17:46:00,018: DEBUG/MainProcess] TaskPool: Apply <function _fast_trace_task at 0x7fadec10d620> (args:('boxing_console.tasks.refund_after_order_overdue', 'cd48a5ea-e6cb-43ff-a855-a24fc24ee5dd', {'lang': 'py', 'task': 'boxing_console.tasks.refund_after_order_overdue', 'id': 'cd48a5ea-e6cb-43ff-a855-a24fc24ee5dd', 'shadow': None, 'eta': None, 'expires': None, 'group': None, 'retries': 0, 'timelimit': [None, None], 'root_id': 'cd48a5ea-e6cb-43ff-a855-a24fc24ee5dd', 'parent_id': None, 'argsrepr': '()', 'kwargsrepr': '{}', 'origin': 'gen216@7b8d459fb4db', 'reply_to': '26979d60-d808-3d32-bcd7-c6f48a392674', 'correlation_id': 'cd48a5ea-e6cb-43ff-a855-a24fc24ee5dd', 'delivery_info': {'exchange': '', 'routing_key': 'celery', 'priority': 0, 'redelivered': None}}, b'[[], {}, {"callbacks": null, "errbacks": null, "chain": null, "chord": null}]', 'application/json', 'utf-8') kwargs:{})
[2018-09-18 17:46:00,022: DEBUG/MainProcess] Task accepted: boxing_console.tasks.refund_after_order_overdue[cd48a5ea-e6cb-43ff-a855-a24fc24ee5dd] pid:250
(0.001) SET SESSION TRANSACTION ISOLATION LEVEL READ COMMITTED; args=None
[2018-09-18 17:46:00,028: DEBUG/ForkPoolWorker-4] (0.001) SET SESSION TRANSACTION ISOLATION LEVEL READ COMMITTED; args=None
(0.005) SELECT `course_order`.`id`, `course_order`.`pay_order_id`, `course_order`.`boxer_id`, `course_order`.`user_id`, `course_order`.`club_id`, `course_order`.`course_id`, `course_order`.`course_name`, `course_order`.`course_price`, `course_order`.`course_duration`, `course_order`.`course_validity`, `course_order`.`order_number`, `course_order`.`status`, `course_order`.`order_time`, `course_order`.`pay_time`, `course_order`.`confirm_status`, `course_order`.`boxer_confirm_time`, `course_order`.`user_confirm_time`, `course_order`.`finish_time`, `course_order`.`amount`, `course_order`.`insurance_amount`, `course_order`.`refund_record_id`, `course_order`.`is_deleted` FROM `course_order` WHERE (`course_order`.`is_deleted` = 0 AND `course_order`.`course_validity` < '2018-09-18' AND `course_order`.`refund_record_id` IS NULL AND `course_order`.`status` = 5) ORDER BY `course_order`.`order_time` DESC; args=(False, '2018-09-18', 5)
[2018-09-18 17:46:00,033: DEBUG/ForkPoolWorker-4] (0.005) SELECT `course_order`.`id`, `course_order`.`pay_order_id`, `course_order`.`boxer_id`, `course_order`.`user_id`, `course_order`.`club_id`, `course_order`.`course_id`, `course_order`.`course_name`, `course_order`.`course_price`, `course_order`.`course_duration`, `course_order`.`course_validity`, `course_order`.`order_number`, `course_order`.`status`, `course_order`.`order_time`, `course_order`.`pay_time`, `course_order`.`confirm_status`, `course_order`.`boxer_confirm_time`, `course_order`.`user_confirm_time`, `course_order`.`finish_time`, `course_order`.`amount`, `course_order`.`insurance_amount`, `course_order`.`refund_record_id`, `course_order`.`is_deleted` FROM `course_order` WHERE (`course_order`.`is_deleted` = 0 AND `course_order`.`course_validity` < '2018-09-18' AND `course_order`.`refund_record_id` IS NULL AND `course_order`.`status` = 5) ORDER BY `course_order`.`order_time` DESC; args=(False, '2018-09-18', 5)
[2018-09-18 17:46:00,044: DEBUG/ForkPoolWorker-4] Sending message of length 2929 to http://39.104.180.65/api/2/store/
[2018-09-18 17:46:00,044: ERROR/ForkPoolWorker-4] Task boxing_console.tasks.refund_after_order_overdue[cd48a5ea-e6cb-43ff-a855-a24fc24ee5dd] raised unexpected: TypeError("unsupported operand type(s) for -: 'NoneType' and 'int'")
Traceback (most recent call last):
  File "/usr/local/lib/python3.7/site-packages/celery/app/trace.py", line 382, in trace_task
    R = retval = fun(*args, **kwargs)
  File "/usr/local/lib/python3.7/site-packages/celery/app/trace.py", line 641, in __protected_call__
    return self.run(*args, **kwargs)
  File "/work/boxing_console/tasks.py", line 52, in refund_after_order_overdue
    return_amount = course_order.amount - insurance_amount
TypeError: unsupported operand type(s) for -: 'NoneType' and 'int'
[2018-09-18 17:47:00,018: INFO/MainProcess] Received task: boxing_console.tasks.set_course_overdue[8016f0d4-8c56-44d3-afc9-b70905b815c8]  
[2018-09-18 17:47:00,020: DEBUG/MainProcess] TaskPool: Apply <function _fast_trace_task at 0x7fadec10d620> (args:('boxing_console.tasks.set_course_overdue', '8016f0d4-8c56-44d3-afc9-b70905b815c8', {'lang': 'py', 'task': 'boxing_console.tasks.set_course_overdue', 'id': '8016f0d4-8c56-44d3-afc9-b70905b815c8', 'shadow': None, 'eta': None, 'expires': None, 'group': None, 'retries': 0, 'timelimit': [None, None], 'root_id': '8016f0d4-8c56-44d3-afc9-b70905b815c8', 'parent_id': None, 'argsrepr': '()', 'kwargsrepr': '{}', 'origin': 'gen216@7b8d459fb4db', 'reply_to': '26979d60-d808-3d32-bcd7-c6f48a392674', 'correlation_id': '8016f0d4-8c56-44d3-afc9-b70905b815c8', 'delivery_info': {'exchange': '', 'routing_key': 'celery', 'priority': 0, 'redelivered': None}}, b'[[], {}, {"callbacks": null, "errbacks": null, "chain": null, "chord": null}]', 'application/json', 'utf-8') kwargs:{})
[2018-09-18 17:47:00,023: DEBUG/MainProcess] Task accepted: boxing_console.tasks.set_course_overdue[8016f0d4-8c56-44d3-afc9-b70905b815c8] pid:249
(0.001) UPDATE `course` SET `is_open` = 0 WHERE (`course`.`is_deleted` = 0 AND `course`.`validity` < '2018-09-18'); args=(False, False, '2018-09-18')
[2018-09-18 17:47:00,028: DEBUG/ForkPoolWorker-3] (0.001) UPDATE `course` SET `is_open` = 0 WHERE (`course`.`is_deleted` = 0 AND `course`.`validity` < '2018-09-18'); args=(False, False, '2018-09-18')
[2018-09-18 17:47:00,034: INFO/ForkPoolWorker-3] Task boxing_console.tasks.set_course_overdue[8016f0d4-8c56-44d3-afc9-b70905b815c8] succeeded in 0.011118954000266967s: None
[2018-09-18 17:48:00,012: INFO/MainProcess] Received task: boxing_console.tasks.set_course_overdue[2a05188e-f9fb-4312-861b-864402d8a86f]  
[2018-09-18 17:48:00,012: DEBUG/MainProcess] TaskPool: Apply <function _fast_trace_task at 0x7fadec10d620> (args:('boxing_console.tasks.set_course_overdue', '2a05188e-f9fb-4312-861b-864402d8a86f', {'lang': 'py', 'task': 'boxing_console.tasks.set_course_overdue', 'id': '2a05188e-f9fb-4312-861b-864402d8a86f', 'shadow': None, 'eta': None, 'expires': None, 'group': None, 'retries': 0, 'timelimit': [None, None], 'root_id': '2a05188e-f9fb-4312-861b-864402d8a86f', 'parent_id': None, 'argsrepr': '()', 'kwargsrepr': '{}', 'origin': 'gen216@7b8d459fb4db', 'reply_to': '26979d60-d808-3d32-bcd7-c6f48a392674', 'correlation_id': '2a05188e-f9fb-4312-861b-864402d8a86f', 'delivery_info': {'exchange': '', 'routing_key': 'celery', 'priority': 0, 'redelivered': None}}, b'[[], {}, {"callbacks": null, "errbacks": null, "chain": null, "chord": null}]', 'application/json', 'utf-8') kwargs:{})
[2018-09-18 17:48:00,014: DEBUG/MainProcess] Task accepted: boxing_console.tasks.set_course_overdue[2a05188e-f9fb-4312-861b-864402d8a86f] pid:250
(0.002) UPDATE `course` SET `is_open` = 0 WHERE (`course`.`is_deleted` = 0 AND `course`.`validity` < '2018-09-18'); args=(False, False, '2018-09-18')
[2018-09-18 17:48:00,020: DEBUG/ForkPoolWorker-4] (0.002) UPDATE `course` SET `is_open` = 0 WHERE (`course`.`is_deleted` = 0 AND `course`.`validity` < '2018-09-18'); args=(False, False, '2018-09-18')
[2018-09-18 17:48:00,025: INFO/ForkPoolWorker-4] Task boxing_console.tasks.set_course_overdue[2a05188e-f9fb-4312-861b-864402d8a86f] succeeded in 0.010705685999710113s: None
[2018-09-18 17:49:00,016: INFO/MainProcess] Received task: boxing_console.tasks.order_tear_finished_after_boxer_confirmed[75bed901-f97c-4ca5-8760-021c828a9dee]  
[2018-09-18 17:49:00,017: DEBUG/MainProcess] TaskPool: Apply <function _fast_trace_task at 0x7fadec10d620> (args:('boxing_console.tasks.order_tear_finished_after_boxer_confirmed', '75bed901-f97c-4ca5-8760-021c828a9dee', {'lang': 'py', 'task': 'boxing_console.tasks.order_tear_finished_after_boxer_confirmed', 'id': '75bed901-f97c-4ca5-8760-021c828a9dee', 'shadow': None, 'eta': None, 'expires': None, 'group': None, 'retries': 0, 'timelimit': [None, None], 'root_id': '75bed901-f97c-4ca5-8760-021c828a9dee', 'parent_id': None, 'argsrepr': '()', 'kwargsrepr': '{}', 'origin': 'gen216@7b8d459fb4db', 'reply_to': '26979d60-d808-3d32-bcd7-c6f48a392674', 'correlation_id': '75bed901-f97c-4ca5-8760-021c828a9dee', 'delivery_info': {'exchange': '', 'routing_key': 'celery', 'priority': 0, 'redelivered': None}}, b'[[], {}, {"callbacks": null, "errbacks": null, "chain": null, "chord": null}]', 'application/json', 'utf-8') kwargs:{})
[2018-09-18 17:49:00,020: DEBUG/MainProcess] Task accepted: boxing_console.tasks.order_tear_finished_after_boxer_confirmed[75bed901-f97c-4ca5-8760-021c828a9dee] pid:249
[2018-09-18 17:49:00,021: WARNING/ForkPoolWorker-3] /usr/local/lib/python3.7/site-packages/django/db/models/fields/__init__.py:1423: RuntimeWarning: DateTimeField CourseOrder.boxer_confirm_time received a naive datetime (2018-09-18 17:44:00.020573) while time zone support is active.
  RuntimeWarning)
(0.001) SET SESSION TRANSACTION ISOLATION LEVEL READ COMMITTED; args=None
[2018-09-18 17:49:00,029: DEBUG/ForkPoolWorker-3] (0.001) SET SESSION TRANSACTION ISOLATION LEVEL READ COMMITTED; args=None
(0.003) SELECT `course_order`.`id`, `course_order`.`pay_order_id`, `course_order`.`boxer_id`, `course_order`.`user_id`, `course_order`.`club_id`, `course_order`.`course_id`, `course_order`.`course_name`, `course_order`.`course_price`, `course_order`.`course_duration`, `course_order`.`course_validity`, `course_order`.`order_number`, `course_order`.`status`, `course_order`.`order_time`, `course_order`.`pay_time`, `course_order`.`confirm_status`, `course_order`.`boxer_confirm_time`, `course_order`.`user_confirm_time`, `course_order`.`finish_time`, `course_order`.`amount`, `course_order`.`insurance_amount`, `course_order`.`refund_record_id`, `course_order`.`is_deleted` FROM `course_order` WHERE (`course_order`.`is_deleted` = 0 AND `course_order`.`boxer_confirm_time` < '2018-09-18 09:44:00.020573' AND `course_order`.`confirm_status` = 2) ORDER BY `course_order`.`order_time` DESC; args=(False, '2018-09-18 09:44:00.020573', 2)
[2018-09-18 17:49:00,032: DEBUG/ForkPoolWorker-3] (0.003) SELECT `course_order`.`id`, `course_order`.`pay_order_id`, `course_order`.`boxer_id`, `course_order`.`user_id`, `course_order`.`club_id`, `course_order`.`course_id`, `course_order`.`course_name`, `course_order`.`course_price`, `course_order`.`course_duration`, `course_order`.`course_validity`, `course_order`.`order_number`, `course_order`.`status`, `course_order`.`order_time`, `course_order`.`pay_time`, `course_order`.`confirm_status`, `course_order`.`boxer_confirm_time`, `course_order`.`user_confirm_time`, `course_order`.`finish_time`, `course_order`.`amount`, `course_order`.`insurance_amount`, `course_order`.`refund_record_id`, `course_order`.`is_deleted` FROM `course_order` WHERE (`course_order`.`is_deleted` = 0 AND `course_order`.`boxer_confirm_time` < '2018-09-18 09:44:00.020573' AND `course_order`.`confirm_status` = 2) ORDER BY `course_order`.`order_time` DESC; args=(False, '2018-09-18 09:44:00.020573', 2)
(0.001) SELECT `course`.`id`, `course`.`boxer_id`, `course`.`course_name`, `course`.`price`, `course`.`duration`, `course`.`validity`, `course`.`club_id`, `course`.`is_open`, `course`.`is_deleted` FROM `course` WHERE `course`.`id` = 15; args=(15,)
[2018-09-18 17:49:00,036: DEBUG/ForkPoolWorker-3] (0.001) SELECT `course`.`id`, `course`.`boxer_id`, `course`.`course_name`, `course`.`price`, `course`.`duration`, `course`.`validity`, `course`.`club_id`, `course`.`is_open`, `course`.`is_deleted` FROM `course` WHERE `course`.`id` = 15; args=(15,)
(0.002) SELECT `pay_order`.`id`, `pay_order`.`user_id`, `pay_order`.`content_type_id`, `pay_order`.`object_id`, `pay_order`.`status`, `pay_order`.`out_trade_no`, `pay_order`.`payment_type`, `pay_order`.`amount`, `pay_order`.`device`, `pay_order`.`order_time`, `pay_order`.`pay_time`, `pay_order`.`finish_time` FROM `pay_order` WHERE `pay_order`.`id` = 67; args=(67,)
[2018-09-18 17:49:00,039: DEBUG/ForkPoolWorker-3] (0.002) SELECT `pay_order`.`id`, `pay_order`.`user_id`, `pay_order`.`content_type_id`, `pay_order`.`object_id`, `pay_order`.`status`, `pay_order`.`out_trade_no`, `pay_order`.`payment_type`, `pay_order`.`amount`, `pay_order`.`device`, `pay_order`.`order_time`, `pay_order`.`pay_time`, `pay_order`.`finish_time` FROM `pay_order` WHERE `pay_order`.`id` = 67; args=(67,)
(0.002) SELECT `course_settle_order`.`id`, `course_settle_order`.`order_id`, `course_settle_order`.`course_id`, `course_settle_order`.`course_order_id`, `course_settle_order`.`created_time`, `course_settle_order`.`settled`, `course_settle_order`.`settled_date`, `course_settle_order`.`settled_amount` FROM `course_settle_order` WHERE (`course_settle_order`.`course_id` = 15 AND `course_settle_order`.`course_order_id` = 36 AND `course_settle_order`.`order_id` = 67); args=(15, 36, 67)
[2018-09-18 17:49:00,043: DEBUG/ForkPoolWorker-3] (0.002) SELECT `course_settle_order`.`id`, `course_settle_order`.`order_id`, `course_settle_order`.`course_id`, `course_settle_order`.`course_order_id`, `course_settle_order`.`created_time`, `course_settle_order`.`settled`, `course_settle_order`.`settled_date`, `course_settle_order`.`settled_amount` FROM `course_settle_order` WHERE (`course_settle_order`.`course_id` = 15 AND `course_settle_order`.`course_order_id` = 36 AND `course_settle_order`.`order_id` = 67); args=(15, 36, 67)
(0.002) SELECT `course`.`id`, `course`.`boxer_id`, `course`.`course_name`, `course`.`price`, `course`.`duration`, `course`.`validity`, `course`.`club_id`, `course`.`is_open`, `course`.`is_deleted` FROM `course` WHERE `course`.`id` = 15; args=(15,)
[2018-09-18 17:49:00,048: DEBUG/ForkPoolWorker-3] (0.002) SELECT `course`.`id`, `course`.`boxer_id`, `course`.`course_name`, `course`.`price`, `course`.`duration`, `course`.`validity`, `course`.`club_id`, `course`.`is_open`, `course`.`is_deleted` FROM `course` WHERE `course`.`id` = 15; args=(15,)
(0.001) SELECT `pay_order`.`id`, `pay_order`.`user_id`, `pay_order`.`content_type_id`, `pay_order`.`object_id`, `pay_order`.`status`, `pay_order`.`out_trade_no`, `pay_order`.`payment_type`, `pay_order`.`amount`, `pay_order`.`device`, `pay_order`.`order_time`, `pay_order`.`pay_time`, `pay_order`.`finish_time` FROM `pay_order` WHERE `pay_order`.`id` = 15; args=(15,)
[2018-09-18 17:49:00,051: DEBUG/ForkPoolWorker-3] (0.001) SELECT `pay_order`.`id`, `pay_order`.`user_id`, `pay_order`.`content_type_id`, `pay_order`.`object_id`, `pay_order`.`status`, `pay_order`.`out_trade_no`, `pay_order`.`payment_type`, `pay_order`.`amount`, `pay_order`.`device`, `pay_order`.`order_time`, `pay_order`.`pay_time`, `pay_order`.`finish_time` FROM `pay_order` WHERE `pay_order`.`id` = 15; args=(15,)
(0.001) SELECT `course_settle_order`.`id`, `course_settle_order`.`order_id`, `course_settle_order`.`course_id`, `course_settle_order`.`course_order_id`, `course_settle_order`.`created_time`, `course_settle_order`.`settled`, `course_settle_order`.`settled_date`, `course_settle_order`.`settled_amount` FROM `course_settle_order` WHERE (`course_settle_order`.`course_id` = 15 AND `course_settle_order`.`course_order_id` = 8 AND `course_settle_order`.`order_id` = 15); args=(15, 8, 15)
[2018-09-18 17:49:00,054: DEBUG/ForkPoolWorker-3] (0.001) SELECT `course_settle_order`.`id`, `course_settle_order`.`order_id`, `course_settle_order`.`course_id`, `course_settle_order`.`course_order_id`, `course_settle_order`.`created_time`, `course_settle_order`.`settled`, `course_settle_order`.`settled_date`, `course_settle_order`.`settled_amount` FROM `course_settle_order` WHERE (`course_settle_order`.`course_id` = 15 AND `course_settle_order`.`course_order_id` = 8 AND `course_settle_order`.`order_id` = 15); args=(15, 8, 15)
(0.001) UPDATE `course_order` SET `status` = 3 WHERE (`course_order`.`is_deleted` = 0 AND `course_order`.`boxer_confirm_time` < '2018-09-18 09:44:00.020573' AND `course_order`.`confirm_status` = 2); args=(3, False, '2018-09-18 09:44:00.020573', 2)
[2018-09-18 17:49:00,057: DEBUG/ForkPoolWorker-3] (0.001) UPDATE `course_order` SET `status` = 3 WHERE (`course_order`.`is_deleted` = 0 AND `course_order`.`boxer_confirm_time` < '2018-09-18 09:44:00.020573' AND `course_order`.`confirm_status` = 2); args=(3, False, '2018-09-18 09:44:00.020573', 2)
[2018-09-18 17:49:00,059: INFO/ForkPoolWorker-3] Task boxing_console.tasks.order_tear_finished_after_boxer_confirmed[75bed901-f97c-4ca5-8760-021c828a9dee] succeeded in 0.03944424300061655s: None
[2018-09-18 17:50:00,014: INFO/MainProcess] Received task: boxing_console.tasks.refund_after_order_overdue[191aac2a-65aa-4503-a0dc-1db1f29d1d80]  
[2018-09-18 17:50:00,014: DEBUG/MainProcess] TaskPool: Apply <function _fast_trace_task at 0x7fadec10d620> (args:('boxing_console.tasks.refund_after_order_overdue', '191aac2a-65aa-4503-a0dc-1db1f29d1d80', {'lang': 'py', 'task': 'boxing_console.tasks.refund_after_order_overdue', 'id': '191aac2a-65aa-4503-a0dc-1db1f29d1d80', 'shadow': None, 'eta': None, 'expires': None, 'group': None, 'retries': 0, 'timelimit': [None, None], 'root_id': '191aac2a-65aa-4503-a0dc-1db1f29d1d80', 'parent_id': None, 'argsrepr': '()', 'kwargsrepr': '{}', 'origin': 'gen216@7b8d459fb4db', 'reply_to': '26979d60-d808-3d32-bcd7-c6f48a392674', 'correlation_id': '191aac2a-65aa-4503-a0dc-1db1f29d1d80', 'delivery_info': {'exchange': '', 'routing_key': 'celery', 'priority': 0, 'redelivered': None}}, b'[[], {}, {"callbacks": null, "errbacks": null, "chain": null, "chord": null}]', 'application/json', 'utf-8') kwargs:{})
[2018-09-18 17:50:00,016: DEBUG/MainProcess] Task accepted: boxing_console.tasks.refund_after_order_overdue[191aac2a-65aa-4503-a0dc-1db1f29d1d80] pid:250
(0.001) SET SESSION TRANSACTION ISOLATION LEVEL READ COMMITTED; args=None
[2018-09-18 17:50:00,024: DEBUG/ForkPoolWorker-4] (0.001) SET SESSION TRANSACTION ISOLATION LEVEL READ COMMITTED; args=None
(0.003) SELECT `course_order`.`id`, `course_order`.`pay_order_id`, `course_order`.`boxer_id`, `course_order`.`user_id`, `course_order`.`club_id`, `course_order`.`course_id`, `course_order`.`course_name`, `course_order`.`course_price`, `course_order`.`course_duration`, `course_order`.`course_validity`, `course_order`.`order_number`, `course_order`.`status`, `course_order`.`order_time`, `course_order`.`pay_time`, `course_order`.`confirm_status`, `course_order`.`boxer_confirm_time`, `course_order`.`user_confirm_time`, `course_order`.`finish_time`, `course_order`.`amount`, `course_order`.`insurance_amount`, `course_order`.`refund_record_id`, `course_order`.`is_deleted` FROM `course_order` WHERE (`course_order`.`is_deleted` = 0 AND `course_order`.`course_validity` < '2018-09-18' AND `course_order`.`refund_record_id` IS NULL AND `course_order`.`status` = 5) ORDER BY `course_order`.`order_time` DESC; args=(False, '2018-09-18', 5)
[2018-09-18 17:50:00,028: DEBUG/ForkPoolWorker-4] (0.003) SELECT `course_order`.`id`, `course_order`.`pay_order_id`, `course_order`.`boxer_id`, `course_order`.`user_id`, `course_order`.`club_id`, `course_order`.`course_id`, `course_order`.`course_name`, `course_order`.`course_price`, `course_order`.`course_duration`, `course_order`.`course_validity`, `course_order`.`order_number`, `course_order`.`status`, `course_order`.`order_time`, `course_order`.`pay_time`, `course_order`.`confirm_status`, `course_order`.`boxer_confirm_time`, `course_order`.`user_confirm_time`, `course_order`.`finish_time`, `course_order`.`amount`, `course_order`.`insurance_amount`, `course_order`.`refund_record_id`, `course_order`.`is_deleted` FROM `course_order` WHERE (`course_order`.`is_deleted` = 0 AND `course_order`.`course_validity` < '2018-09-18' AND `course_order`.`refund_record_id` IS NULL AND `course_order`.`status` = 5) ORDER BY `course_order`.`order_time` DESC; args=(False, '2018-09-18', 5)
[2018-09-18 17:50:00,034: INFO/MainProcess] Received task: boxing_console.tasks.order_tear_finished_after_boxer_confirmed[9acf071c-d11c-427b-b6a4-816be9c4f6f2]  
[2018-09-18 17:50:00,034: DEBUG/MainProcess] TaskPool: Apply <function _fast_trace_task at 0x7fadec10d620> (args:('boxing_console.tasks.order_tear_finished_after_boxer_confirmed', '9acf071c-d11c-427b-b6a4-816be9c4f6f2', {'lang': 'py', 'task': 'boxing_console.tasks.order_tear_finished_after_boxer_confirmed', 'id': '9acf071c-d11c-427b-b6a4-816be9c4f6f2', 'shadow': None, 'eta': None, 'expires': None, 'group': None, 'retries': 0, 'timelimit': [None, None], 'root_id': '9acf071c-d11c-427b-b6a4-816be9c4f6f2', 'parent_id': None, 'argsrepr': '()', 'kwargsrepr': '{}', 'origin': 'gen216@7b8d459fb4db', 'reply_to': '26979d60-d808-3d32-bcd7-c6f48a392674', 'correlation_id': '9acf071c-d11c-427b-b6a4-816be9c4f6f2', 'delivery_info': {'exchange': '', 'routing_key': 'celery', 'priority': 0, 'redelivered': None}}, b'[[], {}, {"callbacks": null, "errbacks": null, "chain": null, "chord": null}]', 'application/json', 'utf-8') kwargs:{})
[2018-09-18 17:50:00,036: WARNING/ForkPoolWorker-3] /usr/local/lib/python3.7/site-packages/django/db/models/fields/__init__.py:1423: RuntimeWarning: DateTimeField CourseOrder.boxer_confirm_time received a naive datetime (2018-09-18 17:45:00.035606) while time zone support is active.
  RuntimeWarning)
[2018-09-18 17:50:00,039: DEBUG/MainProcess] Task accepted: boxing_console.tasks.order_tear_finished_after_boxer_confirmed[9acf071c-d11c-427b-b6a4-816be9c4f6f2] pid:249
(0.003) SELECT `course_order`.`id`, `course_order`.`pay_order_id`, `course_order`.`boxer_id`, `course_order`.`user_id`, `course_order`.`club_id`, `course_order`.`course_id`, `course_order`.`course_name`, `course_order`.`course_price`, `course_order`.`course_duration`, `course_order`.`course_validity`, `course_order`.`order_number`, `course_order`.`status`, `course_order`.`order_time`, `course_order`.`pay_time`, `course_order`.`confirm_status`, `course_order`.`boxer_confirm_time`, `course_order`.`user_confirm_time`, `course_order`.`finish_time`, `course_order`.`amount`, `course_order`.`insurance_amount`, `course_order`.`refund_record_id`, `course_order`.`is_deleted` FROM `course_order` WHERE (`course_order`.`is_deleted` = 0 AND `course_order`.`boxer_confirm_time` < '2018-09-18 09:45:00.035606' AND `course_order`.`confirm_status` = 2) ORDER BY `course_order`.`order_time` DESC; args=(False, '2018-09-18 09:45:00.035606', 2)
[2018-09-18 17:50:00,041: DEBUG/ForkPoolWorker-3] (0.003) SELECT `course_order`.`id`, `course_order`.`pay_order_id`, `course_order`.`boxer_id`, `course_order`.`user_id`, `course_order`.`club_id`, `course_order`.`course_id`, `course_order`.`course_name`, `course_order`.`course_price`, `course_order`.`course_duration`, `course_order`.`course_validity`, `course_order`.`order_number`, `course_order`.`status`, `course_order`.`order_time`, `course_order`.`pay_time`, `course_order`.`confirm_status`, `course_order`.`boxer_confirm_time`, `course_order`.`user_confirm_time`, `course_order`.`finish_time`, `course_order`.`amount`, `course_order`.`insurance_amount`, `course_order`.`refund_record_id`, `course_order`.`is_deleted` FROM `course_order` WHERE (`course_order`.`is_deleted` = 0 AND `course_order`.`boxer_confirm_time` < '2018-09-18 09:45:00.035606' AND `course_order`.`confirm_status` = 2) ORDER BY `course_order`.`order_time` DESC; args=(False, '2018-09-18 09:45:00.035606', 2)
[2018-09-18 17:50:00,041: DEBUG/ForkPoolWorker-4] Sending message of length 2923 to http://39.104.180.65/api/2/store/
[2018-09-18 17:50:00,041: ERROR/ForkPoolWorker-4] Task boxing_console.tasks.refund_after_order_overdue[191aac2a-65aa-4503-a0dc-1db1f29d1d80] raised unexpected: TypeError("unsupported operand type(s) for -: 'NoneType' and 'int'")
Traceback (most recent call last):
  File "/usr/local/lib/python3.7/site-packages/celery/app/trace.py", line 382, in trace_task
    R = retval = fun(*args, **kwargs)
  File "/usr/local/lib/python3.7/site-packages/celery/app/trace.py", line 641, in __protected_call__
    return self.run(*args, **kwargs)
  File "/work/boxing_console/tasks.py", line 52, in refund_after_order_overdue
    return_amount = course_order.amount - insurance_amount
TypeError: unsupported operand type(s) for -: 'NoneType' and 'int'
(0.001) SELECT `course`.`id`, `course`.`boxer_id`, `course`.`course_name`, `course`.`price`, `course`.`duration`, `course`.`validity`, `course`.`club_id`, `course`.`is_open`, `course`.`is_deleted` FROM `course` WHERE `course`.`id` = 15; args=(15,)
[2018-09-18 17:50:00,046: DEBUG/ForkPoolWorker-3] (0.001) SELECT `course`.`id`, `course`.`boxer_id`, `course`.`course_name`, `course`.`price`, `course`.`duration`, `course`.`validity`, `course`.`club_id`, `course`.`is_open`, `course`.`is_deleted` FROM `course` WHERE `course`.`id` = 15; args=(15,)
(0.001) SELECT `pay_order`.`id`, `pay_order`.`user_id`, `pay_order`.`content_type_id`, `pay_order`.`object_id`, `pay_order`.`status`, `pay_order`.`out_trade_no`, `pay_order`.`payment_type`, `pay_order`.`amount`, `pay_order`.`device`, `pay_order`.`order_time`, `pay_order`.`pay_time`, `pay_order`.`finish_time` FROM `pay_order` WHERE `pay_order`.`id` = 67; args=(67,)
[2018-09-18 17:50:00,049: DEBUG/ForkPoolWorker-3] (0.001) SELECT `pay_order`.`id`, `pay_order`.`user_id`, `pay_order`.`content_type_id`, `pay_order`.`object_id`, `pay_order`.`status`, `pay_order`.`out_trade_no`, `pay_order`.`payment_type`, `pay_order`.`amount`, `pay_order`.`device`, `pay_order`.`order_time`, `pay_order`.`pay_time`, `pay_order`.`finish_time` FROM `pay_order` WHERE `pay_order`.`id` = 67; args=(67,)
(0.001) SELECT `course_settle_order`.`id`, `course_settle_order`.`order_id`, `course_settle_order`.`course_id`, `course_settle_order`.`course_order_id`, `course_settle_order`.`created_time`, `course_settle_order`.`settled`, `course_settle_order`.`settled_date`, `course_settle_order`.`settled_amount` FROM `course_settle_order` WHERE (`course_settle_order`.`course_id` = 15 AND `course_settle_order`.`course_order_id` = 36 AND `course_settle_order`.`order_id` = 67); args=(15, 36, 67)
[2018-09-18 17:50:00,052: DEBUG/ForkPoolWorker-3] (0.001) SELECT `course_settle_order`.`id`, `course_settle_order`.`order_id`, `course_settle_order`.`course_id`, `course_settle_order`.`course_order_id`, `course_settle_order`.`created_time`, `course_settle_order`.`settled`, `course_settle_order`.`settled_date`, `course_settle_order`.`settled_amount` FROM `course_settle_order` WHERE (`course_settle_order`.`course_id` = 15 AND `course_settle_order`.`course_order_id` = 36 AND `course_settle_order`.`order_id` = 67); args=(15, 36, 67)
(0.001) SELECT `course`.`id`, `course`.`boxer_id`, `course`.`course_name`, `course`.`price`, `course`.`duration`, `course`.`validity`, `course`.`club_id`, `course`.`is_open`, `course`.`is_deleted` FROM `course` WHERE `course`.`id` = 15; args=(15,)
[2018-09-18 17:50:00,054: DEBUG/ForkPoolWorker-3] (0.001) SELECT `course`.`id`, `course`.`boxer_id`, `course`.`course_name`, `course`.`price`, `course`.`duration`, `course`.`validity`, `course`.`club_id`, `course`.`is_open`, `course`.`is_deleted` FROM `course` WHERE `course`.`id` = 15; args=(15,)
(0.001) SELECT `pay_order`.`id`, `pay_order`.`user_id`, `pay_order`.`content_type_id`, `pay_order`.`object_id`, `pay_order`.`status`, `pay_order`.`out_trade_no`, `pay_order`.`payment_type`, `pay_order`.`amount`, `pay_order`.`device`, `pay_order`.`order_time`, `pay_order`.`pay_time`, `pay_order`.`finish_time` FROM `pay_order` WHERE `pay_order`.`id` = 15; args=(15,)
[2018-09-18 17:50:00,057: DEBUG/ForkPoolWorker-3] (0.001) SELECT `pay_order`.`id`, `pay_order`.`user_id`, `pay_order`.`content_type_id`, `pay_order`.`object_id`, `pay_order`.`status`, `pay_order`.`out_trade_no`, `pay_order`.`payment_type`, `pay_order`.`amount`, `pay_order`.`device`, `pay_order`.`order_time`, `pay_order`.`pay_time`, `pay_order`.`finish_time` FROM `pay_order` WHERE `pay_order`.`id` = 15; args=(15,)
(0.001) SELECT `course_settle_order`.`id`, `course_settle_order`.`order_id`, `course_settle_order`.`course_id`, `course_settle_order`.`course_order_id`, `course_settle_order`.`created_time`, `course_settle_order`.`settled`, `course_settle_order`.`settled_date`, `course_settle_order`.`settled_amount` FROM `course_settle_order` WHERE (`course_settle_order`.`course_id` = 15 AND `course_settle_order`.`course_order_id` = 8 AND `course_settle_order`.`order_id` = 15); args=(15, 8, 15)
[2018-09-18 17:50:00,059: DEBUG/ForkPoolWorker-3] (0.001) SELECT `course_settle_order`.`id`, `course_settle_order`.`order_id`, `course_settle_order`.`course_id`, `course_settle_order`.`course_order_id`, `course_settle_order`.`created_time`, `course_settle_order`.`settled`, `course_settle_order`.`settled_date`, `course_settle_order`.`settled_amount` FROM `course_settle_order` WHERE (`course_settle_order`.`course_id` = 15 AND `course_settle_order`.`course_order_id` = 8 AND `course_settle_order`.`order_id` = 15); args=(15, 8, 15)
(0.001) UPDATE `course_order` SET `status` = 3 WHERE (`course_order`.`is_deleted` = 0 AND `course_order`.`boxer_confirm_time` < '2018-09-18 09:45:00.035606' AND `course_order`.`confirm_status` = 2); args=(3, False, '2018-09-18 09:45:00.035606', 2)
[2018-09-18 17:50:00,062: DEBUG/ForkPoolWorker-3] (0.001) UPDATE `course_order` SET `status` = 3 WHERE (`course_order`.`is_deleted` = 0 AND `course_order`.`boxer_confirm_time` < '2018-09-18 09:45:00.035606' AND `course_order`.`confirm_status` = 2); args=(3, False, '2018-09-18 09:45:00.035606', 2)
[2018-09-18 17:50:00,065: INFO/ForkPoolWorker-3] Task boxing_console.tasks.order_tear_finished_after_boxer_confirmed[9acf071c-d11c-427b-b6a4-816be9c4f6f2] succeeded in 0.02998418500283151s: None
[2018-09-18 17:51:00,012: INFO/MainProcess] Received task: boxing_console.tasks.order_tear_finished_after_boxer_confirmed[f6c90168-aadd-4ca2-95c4-3257e5ae17f5]  
[2018-09-18 17:51:00,013: DEBUG/MainProcess] TaskPool: Apply <function _fast_trace_task at 0x7fadec10d620> (args:('boxing_console.tasks.order_tear_finished_after_boxer_confirmed', 'f6c90168-aadd-4ca2-95c4-3257e5ae17f5', {'lang': 'py', 'task': 'boxing_console.tasks.order_tear_finished_after_boxer_confirmed', 'id': 'f6c90168-aadd-4ca2-95c4-3257e5ae17f5', 'shadow': None, 'eta': None, 'expires': None, 'group': None, 'retries': 0, 'timelimit': [None, None], 'root_id': 'f6c90168-aadd-4ca2-95c4-3257e5ae17f5', 'parent_id': None, 'argsrepr': '()', 'kwargsrepr': '{}', 'origin': 'gen216@7b8d459fb4db', 'reply_to': '26979d60-d808-3d32-bcd7-c6f48a392674', 'correlation_id': 'f6c90168-aadd-4ca2-95c4-3257e5ae17f5', 'delivery_info': {'exchange': '', 'routing_key': 'celery', 'priority': 0, 'redelivered': None}}, b'[[], {}, {"callbacks": null, "errbacks": null, "chain": null, "chord": null}]', 'application/json', 'utf-8') kwargs:{})
[2018-09-18 17:51:00,014: DEBUG/MainProcess] Task accepted: boxing_console.tasks.order_tear_finished_after_boxer_confirmed[f6c90168-aadd-4ca2-95c4-3257e5ae17f5] pid:250
[2018-09-18 17:51:00,015: WARNING/ForkPoolWorker-4] /usr/local/lib/python3.7/site-packages/django/db/models/fields/__init__.py:1423: RuntimeWarning: DateTimeField CourseOrder.boxer_confirm_time received a naive datetime (2018-09-18 17:46:00.014536) while time zone support is active.
  RuntimeWarning)
(0.003) SELECT `course_order`.`id`, `course_order`.`pay_order_id`, `course_order`.`boxer_id`, `course_order`.`user_id`, `course_order`.`club_id`, `course_order`.`course_id`, `course_order`.`course_name`, `course_order`.`course_price`, `course_order`.`course_duration`, `course_order`.`course_validity`, `course_order`.`order_number`, `course_order`.`status`, `course_order`.`order_time`, `course_order`.`pay_time`, `course_order`.`confirm_status`, `course_order`.`boxer_confirm_time`, `course_order`.`user_confirm_time`, `course_order`.`finish_time`, `course_order`.`amount`, `course_order`.`insurance_amount`, `course_order`.`refund_record_id`, `course_order`.`is_deleted` FROM `course_order` WHERE (`course_order`.`is_deleted` = 0 AND `course_order`.`boxer_confirm_time` < '2018-09-18 09:46:00.014536' AND `course_order`.`confirm_status` = 2) ORDER BY `course_order`.`order_time` DESC; args=(False, '2018-09-18 09:46:00.014536', 2)
[2018-09-18 17:51:00,019: DEBUG/ForkPoolWorker-4] (0.003) SELECT `course_order`.`id`, `course_order`.`pay_order_id`, `course_order`.`boxer_id`, `course_order`.`user_id`, `course_order`.`club_id`, `course_order`.`course_id`, `course_order`.`course_name`, `course_order`.`course_price`, `course_order`.`course_duration`, `course_order`.`course_validity`, `course_order`.`order_number`, `course_order`.`status`, `course_order`.`order_time`, `course_order`.`pay_time`, `course_order`.`confirm_status`, `course_order`.`boxer_confirm_time`, `course_order`.`user_confirm_time`, `course_order`.`finish_time`, `course_order`.`amount`, `course_order`.`insurance_amount`, `course_order`.`refund_record_id`, `course_order`.`is_deleted` FROM `course_order` WHERE (`course_order`.`is_deleted` = 0 AND `course_order`.`boxer_confirm_time` < '2018-09-18 09:46:00.014536' AND `course_order`.`confirm_status` = 2) ORDER BY `course_order`.`order_time` DESC; args=(False, '2018-09-18 09:46:00.014536', 2)
(0.002) SELECT `course`.`id`, `course`.`boxer_id`, `course`.`course_name`, `course`.`price`, `course`.`duration`, `course`.`validity`, `course`.`club_id`, `course`.`is_open`, `course`.`is_deleted` FROM `course` WHERE `course`.`id` = 15; args=(15,)
[2018-09-18 17:51:00,024: DEBUG/ForkPoolWorker-4] (0.002) SELECT `course`.`id`, `course`.`boxer_id`, `course`.`course_name`, `course`.`price`, `course`.`duration`, `course`.`validity`, `course`.`club_id`, `course`.`is_open`, `course`.`is_deleted` FROM `course` WHERE `course`.`id` = 15; args=(15,)
[2018-09-18 17:51:00,027: INFO/MainProcess] Received task: boxing_console.tasks.refund_after_order_overdue[a44f1f3f-cb7e-4f41-922f-4df3411ff425]  
[2018-09-18 17:51:00,028: DEBUG/MainProcess] TaskPool: Apply <function _fast_trace_task at 0x7fadec10d620> (args:('boxing_console.tasks.refund_after_order_overdue', 'a44f1f3f-cb7e-4f41-922f-4df3411ff425', {'lang': 'py', 'task': 'boxing_console.tasks.refund_after_order_overdue', 'id': 'a44f1f3f-cb7e-4f41-922f-4df3411ff425', 'shadow': None, 'eta': None, 'expires': None, 'group': None, 'retries': 0, 'timelimit': [None, None], 'root_id': 'a44f1f3f-cb7e-4f41-922f-4df3411ff425', 'parent_id': None, 'argsrepr': '()', 'kwargsrepr': '{}', 'origin': 'gen216@7b8d459fb4db', 'reply_to': '26979d60-d808-3d32-bcd7-c6f48a392674', 'correlation_id': 'a44f1f3f-cb7e-4f41-922f-4df3411ff425', 'delivery_info': {'exchange': '', 'routing_key': 'celery', 'priority': 0, 'redelivered': None}}, b'[[], {}, {"callbacks": null, "errbacks": null, "chain": null, "chord": null}]', 'application/json', 'utf-8') kwargs:{})
[2018-09-18 17:51:00,030: DEBUG/MainProcess] Task accepted: boxing_console.tasks.refund_after_order_overdue[a44f1f3f-cb7e-4f41-922f-4df3411ff425] pid:249
(0.005) SELECT `pay_order`.`id`, `pay_order`.`user_id`, `pay_order`.`content_type_id`, `pay_order`.`object_id`, `pay_order`.`status`, `pay_order`.`out_trade_no`, `pay_order`.`payment_type`, `pay_order`.`amount`, `pay_order`.`device`, `pay_order`.`order_time`, `pay_order`.`pay_time`, `pay_order`.`finish_time` FROM `pay_order` WHERE `pay_order`.`id` = 67; args=(67,)
[2018-09-18 17:51:00,030: DEBUG/ForkPoolWorker-4] (0.005) SELECT `pay_order`.`id`, `pay_order`.`user_id`, `pay_order`.`content_type_id`, `pay_order`.`object_id`, `pay_order`.`status`, `pay_order`.`out_trade_no`, `pay_order`.`payment_type`, `pay_order`.`amount`, `pay_order`.`device`, `pay_order`.`order_time`, `pay_order`.`pay_time`, `pay_order`.`finish_time` FROM `pay_order` WHERE `pay_order`.`id` = 67; args=(67,)
(0.004) SELECT `course_settle_order`.`id`, `course_settle_order`.`order_id`, `course_settle_order`.`course_id`, `course_settle_order`.`course_order_id`, `course_settle_order`.`created_time`, `course_settle_order`.`settled`, `course_settle_order`.`settled_date`, `course_settle_order`.`settled_amount` FROM `course_settle_order` WHERE (`course_settle_order`.`course_id` = 15 AND `course_settle_order`.`course_order_id` = 36 AND `course_settle_order`.`order_id` = 67); args=(15, 36, 67)
[2018-09-18 17:51:00,037: DEBUG/ForkPoolWorker-4] (0.004) SELECT `course_settle_order`.`id`, `course_settle_order`.`order_id`, `course_settle_order`.`course_id`, `course_settle_order`.`course_order_id`, `course_settle_order`.`created_time`, `course_settle_order`.`settled`, `course_settle_order`.`settled_date`, `course_settle_order`.`settled_amount` FROM `course_settle_order` WHERE (`course_settle_order`.`course_id` = 15 AND `course_settle_order`.`course_order_id` = 36 AND `course_settle_order`.`order_id` = 67); args=(15, 36, 67)
(0.001) SET SESSION TRANSACTION ISOLATION LEVEL READ COMMITTED; args=None
[2018-09-18 17:51:00,039: DEBUG/ForkPoolWorker-3] (0.001) SET SESSION TRANSACTION ISOLATION LEVEL READ COMMITTED; args=None
(0.001) SELECT `course`.`id`, `course`.`boxer_id`, `course`.`course_name`, `course`.`price`, `course`.`duration`, `course`.`validity`, `course`.`club_id`, `course`.`is_open`, `course`.`is_deleted` FROM `course` WHERE `course`.`id` = 15; args=(15,)
[2018-09-18 17:51:00,040: DEBUG/ForkPoolWorker-4] (0.001) SELECT `course`.`id`, `course`.`boxer_id`, `course`.`course_name`, `course`.`price`, `course`.`duration`, `course`.`validity`, `course`.`club_id`, `course`.`is_open`, `course`.`is_deleted` FROM `course` WHERE `course`.`id` = 15; args=(15,)
(0.003) SELECT `course_order`.`id`, `course_order`.`pay_order_id`, `course_order`.`boxer_id`, `course_order`.`user_id`, `course_order`.`club_id`, `course_order`.`course_id`, `course_order`.`course_name`, `course_order`.`course_price`, `course_order`.`course_duration`, `course_order`.`course_validity`, `course_order`.`order_number`, `course_order`.`status`, `course_order`.`order_time`, `course_order`.`pay_time`, `course_order`.`confirm_status`, `course_order`.`boxer_confirm_time`, `course_order`.`user_confirm_time`, `course_order`.`finish_time`, `course_order`.`amount`, `course_order`.`insurance_amount`, `course_order`.`refund_record_id`, `course_order`.`is_deleted` FROM `course_order` WHERE (`course_order`.`is_deleted` = 0 AND `course_order`.`course_validity` < '2018-09-18' AND `course_order`.`refund_record_id` IS NULL AND `course_order`.`status` = 5) ORDER BY `course_order`.`order_time` DESC; args=(False, '2018-09-18', 5)
(0.001) SELECT `pay_order`.`id`, `pay_order`.`user_id`, `pay_order`.`content_type_id`, `pay_order`.`object_id`, `pay_order`.`status`, `pay_order`.`out_trade_no`, `pay_order`.`payment_type`, `pay_order`.`amount`, `pay_order`.`device`, `pay_order`.`order_time`, `pay_order`.`pay_time`, `pay_order`.`finish_time` FROM `pay_order` WHERE `pay_order`.`id` = 15; args=(15,)
[2018-09-18 17:51:00,042: DEBUG/ForkPoolWorker-4] (0.001) SELECT `pay_order`.`id`, `pay_order`.`user_id`, `pay_order`.`content_type_id`, `pay_order`.`object_id`, `pay_order`.`status`, `pay_order`.`out_trade_no`, `pay_order`.`payment_type`, `pay_order`.`amount`, `pay_order`.`device`, `pay_order`.`order_time`, `pay_order`.`pay_time`, `pay_order`.`finish_time` FROM `pay_order` WHERE `pay_order`.`id` = 15; args=(15,)
[2018-09-18 17:51:00,042: DEBUG/ForkPoolWorker-3] (0.003) SELECT `course_order`.`id`, `course_order`.`pay_order_id`, `course_order`.`boxer_id`, `course_order`.`user_id`, `course_order`.`club_id`, `course_order`.`course_id`, `course_order`.`course_name`, `course_order`.`course_price`, `course_order`.`course_duration`, `course_order`.`course_validity`, `course_order`.`order_number`, `course_order`.`status`, `course_order`.`order_time`, `course_order`.`pay_time`, `course_order`.`confirm_status`, `course_order`.`boxer_confirm_time`, `course_order`.`user_confirm_time`, `course_order`.`finish_time`, `course_order`.`amount`, `course_order`.`insurance_amount`, `course_order`.`refund_record_id`, `course_order`.`is_deleted` FROM `course_order` WHERE (`course_order`.`is_deleted` = 0 AND `course_order`.`course_validity` < '2018-09-18' AND `course_order`.`refund_record_id` IS NULL AND `course_order`.`status` = 5) ORDER BY `course_order`.`order_time` DESC; args=(False, '2018-09-18', 5)
(0.001) SELECT `course_settle_order`.`id`, `course_settle_order`.`order_id`, `course_settle_order`.`course_id`, `course_settle_order`.`course_order_id`, `course_settle_order`.`created_time`, `course_settle_order`.`settled`, `course_settle_order`.`settled_date`, `course_settle_order`.`settled_amount` FROM `course_settle_order` WHERE (`course_settle_order`.`course_id` = 15 AND `course_settle_order`.`course_order_id` = 8 AND `course_settle_order`.`order_id` = 15); args=(15, 8, 15)
[2018-09-18 17:51:00,045: DEBUG/ForkPoolWorker-4] (0.001) SELECT `course_settle_order`.`id`, `course_settle_order`.`order_id`, `course_settle_order`.`course_id`, `course_settle_order`.`course_order_id`, `course_settle_order`.`created_time`, `course_settle_order`.`settled`, `course_settle_order`.`settled_date`, `course_settle_order`.`settled_amount` FROM `course_settle_order` WHERE (`course_settle_order`.`course_id` = 15 AND `course_settle_order`.`course_order_id` = 8 AND `course_settle_order`.`order_id` = 15); args=(15, 8, 15)
(0.001) UPDATE `course_order` SET `status` = 3 WHERE (`course_order`.`is_deleted` = 0 AND `course_order`.`boxer_confirm_time` < '2018-09-18 09:46:00.014536' AND `course_order`.`confirm_status` = 2); args=(3, False, '2018-09-18 09:46:00.014536', 2)
[2018-09-18 17:51:00,047: DEBUG/ForkPoolWorker-4] (0.001) UPDATE `course_order` SET `status` = 3 WHERE (`course_order`.`is_deleted` = 0 AND `course_order`.`boxer_confirm_time` < '2018-09-18 09:46:00.014536' AND `course_order`.`confirm_status` = 2); args=(3, False, '2018-09-18 09:46:00.014536', 2)
[2018-09-18 17:51:00,051: INFO/ForkPoolWorker-4] Task boxing_console.tasks.order_tear_finished_after_boxer_confirmed[f6c90168-aadd-4ca2-95c4-3257e5ae17f5] succeeded in 0.03727863600215642s: None
[2018-09-18 17:51:00,053: DEBUG/ForkPoolWorker-3] Sending message of length 2931 to http://39.104.180.65/api/2/store/
[2018-09-18 17:51:00,054: ERROR/ForkPoolWorker-3] Task boxing_console.tasks.refund_after_order_overdue[a44f1f3f-cb7e-4f41-922f-4df3411ff425] raised unexpected: TypeError("unsupported operand type(s) for -: 'NoneType' and 'int'")
Traceback (most recent call last):
  File "/usr/local/lib/python3.7/site-packages/celery/app/trace.py", line 382, in trace_task
    R = retval = fun(*args, **kwargs)
  File "/usr/local/lib/python3.7/site-packages/celery/app/trace.py", line 641, in __protected_call__
    return self.run(*args, **kwargs)
  File "/work/boxing_console/tasks.py", line 52, in refund_after_order_overdue
    return_amount = course_order.amount - insurance_amount
TypeError: unsupported operand type(s) for -: 'NoneType' and 'int'
[2018-09-18 17:52:00,022: INFO/MainProcess] Received task: boxing_console.tasks.settle_order_task[cf51f9ab-6573-4b8f-a586-a6b31a32dc86]  
[2018-09-18 17:52:00,023: DEBUG/MainProcess] TaskPool: Apply <function _fast_trace_task at 0x7fadec10d620> (args:('boxing_console.tasks.settle_order_task', 'cf51f9ab-6573-4b8f-a586-a6b31a32dc86', {'lang': 'py', 'task': 'boxing_console.tasks.settle_order_task', 'id': 'cf51f9ab-6573-4b8f-a586-a6b31a32dc86', 'shadow': None, 'eta': None, 'expires': None, 'group': None, 'retries': 0, 'timelimit': [None, None], 'root_id': 'cf51f9ab-6573-4b8f-a586-a6b31a32dc86', 'parent_id': None, 'argsrepr': '()', 'kwargsrepr': '{}', 'origin': 'gen216@7b8d459fb4db', 'reply_to': '26979d60-d808-3d32-bcd7-c6f48a392674', 'correlation_id': 'cf51f9ab-6573-4b8f-a586-a6b31a32dc86', 'delivery_info': {'exchange': '', 'routing_key': 'celery', 'priority': 0, 'redelivered': None}}, b'[[], {}, {"callbacks": null, "errbacks": null, "chain": null, "chord": null}]', 'application/json', 'utf-8') kwargs:{})
[2018-09-18 17:52:00,026: WARNING/ForkPoolWorker-4] /usr/local/lib/python3.7/site-packages/django/db/models/fields/__init__.py:1423: RuntimeWarning: DateTimeField CourseSettleOrder.created_time received a naive datetime (2018-09-18 17:47:00.025627) while time zone support is active.
  RuntimeWarning)
[2018-09-18 17:52:00,028: DEBUG/MainProcess] Task accepted: boxing_console.tasks.settle_order_task[cf51f9ab-6573-4b8f-a586-a6b31a32dc86] pid:250
(0.001) SET SESSION TRANSACTION ISOLATION LEVEL READ COMMITTED; args=None
[2018-09-18 17:52:00,037: DEBUG/ForkPoolWorker-4] (0.001) SET SESSION TRANSACTION ISOLATION LEVEL READ COMMITTED; args=None
(0.002) SELECT `course_settle_order`.`id`, `course_settle_order`.`order_id`, `course_settle_order`.`course_id`, `course_settle_order`.`course_order_id`, `course_settle_order`.`created_time`, `course_settle_order`.`settled`, `course_settle_order`.`settled_date`, `course_settle_order`.`settled_amount` FROM `course_settle_order` WHERE (`course_settle_order`.`created_time` < '2018-09-18 09:47:00.025627' AND `course_settle_order`.`settled` = 0) ORDER BY `course_settle_order`.`created_time` DESC; args=('2018-09-18 09:47:00.025627', False)
[2018-09-18 17:52:00,039: DEBUG/ForkPoolWorker-4] (0.002) SELECT `course_settle_order`.`id`, `course_settle_order`.`order_id`, `course_settle_order`.`course_id`, `course_settle_order`.`course_order_id`, `course_settle_order`.`created_time`, `course_settle_order`.`settled`, `course_settle_order`.`settled_date`, `course_settle_order`.`settled_amount` FROM `course_settle_order` WHERE (`course_settle_order`.`created_time` < '2018-09-18 09:47:00.025627' AND `course_settle_order`.`settled` = 0) ORDER BY `course_settle_order`.`created_time` DESC; args=('2018-09-18 09:47:00.025627', False)
[2018-09-18 17:52:00,040: INFO/ForkPoolWorker-4] Task boxing_console.tasks.settle_order_task[cf51f9ab-6573-4b8f-a586-a6b31a32dc86] succeeded in 0.015029449001303874s: None
[2018-09-18 17:53:00,023: INFO/MainProcess] Received task: boxing_console.tasks.set_course_overdue[e48b09eb-5852-46c6-9d19-45c974a31917]  
[2018-09-18 17:53:00,024: DEBUG/MainProcess] TaskPool: Apply <function _fast_trace_task at 0x7fadec10d620> (args:('boxing_console.tasks.set_course_overdue', 'e48b09eb-5852-46c6-9d19-45c974a31917', {'lang': 'py', 'task': 'boxing_console.tasks.set_course_overdue', 'id': 'e48b09eb-5852-46c6-9d19-45c974a31917', 'shadow': None, 'eta': None, 'expires': None, 'group': None, 'retries': 0, 'timelimit': [None, None], 'root_id': 'e48b09eb-5852-46c6-9d19-45c974a31917', 'parent_id': None, 'argsrepr': '()', 'kwargsrepr': '{}', 'origin': 'gen216@7b8d459fb4db', 'reply_to': '26979d60-d808-3d32-bcd7-c6f48a392674', 'correlation_id': 'e48b09eb-5852-46c6-9d19-45c974a31917', 'delivery_info': {'exchange': '', 'routing_key': 'celery', 'priority': 0, 'redelivered': None}}, b'[[], {}, {"callbacks": null, "errbacks": null, "chain": null, "chord": null}]', 'application/json', 'utf-8') kwargs:{})
[2018-09-18 17:53:00,026: DEBUG/MainProcess] Task accepted: boxing_console.tasks.set_course_overdue[e48b09eb-5852-46c6-9d19-45c974a31917] pid:249
(0.002) UPDATE `course` SET `is_open` = 0 WHERE (`course`.`is_deleted` = 0 AND `course`.`validity` < '2018-09-18'); args=(False, False, '2018-09-18')
[2018-09-18 17:53:00,030: DEBUG/ForkPoolWorker-3] (0.002) UPDATE `course` SET `is_open` = 0 WHERE (`course`.`is_deleted` = 0 AND `course`.`validity` < '2018-09-18'); args=(False, False, '2018-09-18')
[2018-09-18 17:53:00,037: INFO/ForkPoolWorker-3] Task boxing_console.tasks.set_course_overdue[e48b09eb-5852-46c6-9d19-45c974a31917] succeeded in 0.011431395003455691s: None
[2018-09-18 17:54:00,009: INFO/MainProcess] Received task: boxing_console.tasks.set_course_overdue[ba8fbac3-b934-4cb9-bcb3-56c5bd5999b6]  
[2018-09-18 17:54:00,009: DEBUG/MainProcess] TaskPool: Apply <function _fast_trace_task at 0x7fadec10d620> (args:('boxing_console.tasks.set_course_overdue', 'ba8fbac3-b934-4cb9-bcb3-56c5bd5999b6', {'lang': 'py', 'task': 'boxing_console.tasks.set_course_overdue', 'id': 'ba8fbac3-b934-4cb9-bcb3-56c5bd5999b6', 'shadow': None, 'eta': None, 'expires': None, 'group': None, 'retries': 0, 'timelimit': [None, None], 'root_id': 'ba8fbac3-b934-4cb9-bcb3-56c5bd5999b6', 'parent_id': None, 'argsrepr': '()', 'kwargsrepr': '{}', 'origin': 'gen216@7b8d459fb4db', 'reply_to': '26979d60-d808-3d32-bcd7-c6f48a392674', 'correlation_id': 'ba8fbac3-b934-4cb9-bcb3-56c5bd5999b6', 'delivery_info': {'exchange': '', 'routing_key': 'celery', 'priority': 0, 'redelivered': None}}, b'[[], {}, {"callbacks": null, "errbacks": null, "chain": null, "chord": null}]', 'application/json', 'utf-8') kwargs:{})
[2018-09-18 17:54:00,011: DEBUG/MainProcess] Task accepted: boxing_console.tasks.set_course_overdue[ba8fbac3-b934-4cb9-bcb3-56c5bd5999b6] pid:250
(0.002) UPDATE `course` SET `is_open` = 0 WHERE (`course`.`is_deleted` = 0 AND `course`.`validity` < '2018-09-18'); args=(False, False, '2018-09-18')
[2018-09-18 17:54:00,017: DEBUG/ForkPoolWorker-4] (0.002) UPDATE `course` SET `is_open` = 0 WHERE (`course`.`is_deleted` = 0 AND `course`.`validity` < '2018-09-18'); args=(False, False, '2018-09-18')
[2018-09-18 17:54:00,023: INFO/ForkPoolWorker-4] Task boxing_console.tasks.set_course_overdue[ba8fbac3-b934-4cb9-bcb3-56c5bd5999b6] succeeded in 0.012150962000305299s: None
[2018-09-18 17:55:00,014: INFO/MainProcess] Received task: boxing_console.tasks.order_tear_finished_after_boxer_confirmed[50a21302-4812-4bf1-a55d-69b15cdf98cb]  
[2018-09-18 17:55:00,015: DEBUG/MainProcess] TaskPool: Apply <function _fast_trace_task at 0x7fadec10d620> (args:('boxing_console.tasks.order_tear_finished_after_boxer_confirmed', '50a21302-4812-4bf1-a55d-69b15cdf98cb', {'lang': 'py', 'task': 'boxing_console.tasks.order_tear_finished_after_boxer_confirmed', 'id': '50a21302-4812-4bf1-a55d-69b15cdf98cb', 'shadow': None, 'eta': None, 'expires': None, 'group': None, 'retries': 0, 'timelimit': [None, None], 'root_id': '50a21302-4812-4bf1-a55d-69b15cdf98cb', 'parent_id': None, 'argsrepr': '()', 'kwargsrepr': '{}', 'origin': 'gen216@7b8d459fb4db', 'reply_to': '26979d60-d808-3d32-bcd7-c6f48a392674', 'correlation_id': '50a21302-4812-4bf1-a55d-69b15cdf98cb', 'delivery_info': {'exchange': '', 'routing_key': 'celery', 'priority': 0, 'redelivered': None}}, b'[[], {}, {"callbacks": null, "errbacks": null, "chain": null, "chord": null}]', 'application/json', 'utf-8') kwargs:{})
[2018-09-18 17:55:00,017: DEBUG/MainProcess] Task accepted: boxing_console.tasks.order_tear_finished_after_boxer_confirmed[50a21302-4812-4bf1-a55d-69b15cdf98cb] pid:249
[2018-09-18 17:55:00,018: WARNING/ForkPoolWorker-3] /usr/local/lib/python3.7/site-packages/django/db/models/fields/__init__.py:1423: RuntimeWarning: DateTimeField CourseOrder.boxer_confirm_time received a naive datetime (2018-09-18 17:50:00.017445) while time zone support is active.
  RuntimeWarning)
[2018-09-18 17:55:00,034: INFO/MainProcess] Received task: boxing_console.tasks.refund_after_order_overdue[39978b5c-21cf-4fab-a44e-dd5bd5218de2]  
[2018-09-18 17:55:00,034: DEBUG/MainProcess] TaskPool: Apply <function _fast_trace_task at 0x7fadec10d620> (args:('boxing_console.tasks.refund_after_order_overdue', '39978b5c-21cf-4fab-a44e-dd5bd5218de2', {'lang': 'py', 'task': 'boxing_console.tasks.refund_after_order_overdue', 'id': '39978b5c-21cf-4fab-a44e-dd5bd5218de2', 'shadow': None, 'eta': None, 'expires': None, 'group': None, 'retries': 0, 'timelimit': [None, None], 'root_id': '39978b5c-21cf-4fab-a44e-dd5bd5218de2', 'parent_id': None, 'argsrepr': '()', 'kwargsrepr': '{}', 'origin': 'gen216@7b8d459fb4db', 'reply_to': '26979d60-d808-3d32-bcd7-c6f48a392674', 'correlation_id': '39978b5c-21cf-4fab-a44e-dd5bd5218de2', 'delivery_info': {'exchange': '', 'routing_key': 'celery', 'priority': 0, 'redelivered': None}}, b'[[], {}, {"callbacks": null, "errbacks": null, "chain": null, "chord": null}]', 'application/json', 'utf-8') kwargs:{})
(0.002) SET SESSION TRANSACTION ISOLATION LEVEL READ COMMITTED; args=None
[2018-09-18 17:55:00,035: DEBUG/ForkPoolWorker-3] (0.002) SET SESSION TRANSACTION ISOLATION LEVEL READ COMMITTED; args=None
(0.003) SELECT `course_order`.`id`, `course_order`.`pay_order_id`, `course_order`.`boxer_id`, `course_order`.`user_id`, `course_order`.`club_id`, `course_order`.`course_id`, `course_order`.`course_name`, `course_order`.`course_price`, `course_order`.`course_duration`, `course_order`.`course_validity`, `course_order`.`order_number`, `course_order`.`status`, `course_order`.`order_time`, `course_order`.`pay_time`, `course_order`.`confirm_status`, `course_order`.`boxer_confirm_time`, `course_order`.`user_confirm_time`, `course_order`.`finish_time`, `course_order`.`amount`, `course_order`.`insurance_amount`, `course_order`.`refund_record_id`, `course_order`.`is_deleted` FROM `course_order` WHERE (`course_order`.`is_deleted` = 0 AND `course_order`.`boxer_confirm_time` < '2018-09-18 09:50:00.017445' AND `course_order`.`confirm_status` = 2) ORDER BY `course_order`.`order_time` DESC; args=(False, '2018-09-18 09:50:00.017445', 2)
[2018-09-18 17:55:00,038: DEBUG/ForkPoolWorker-3] (0.003) SELECT `course_order`.`id`, `course_order`.`pay_order_id`, `course_order`.`boxer_id`, `course_order`.`user_id`, `course_order`.`club_id`, `course_order`.`course_id`, `course_order`.`course_name`, `course_order`.`course_price`, `course_order`.`course_duration`, `course_order`.`course_validity`, `course_order`.`order_number`, `course_order`.`status`, `course_order`.`order_time`, `course_order`.`pay_time`, `course_order`.`confirm_status`, `course_order`.`boxer_confirm_time`, `course_order`.`user_confirm_time`, `course_order`.`finish_time`, `course_order`.`amount`, `course_order`.`insurance_amount`, `course_order`.`refund_record_id`, `course_order`.`is_deleted` FROM `course_order` WHERE (`course_order`.`is_deleted` = 0 AND `course_order`.`boxer_confirm_time` < '2018-09-18 09:50:00.017445' AND `course_order`.`confirm_status` = 2) ORDER BY `course_order`.`order_time` DESC; args=(False, '2018-09-18 09:50:00.017445', 2)
[2018-09-18 17:55:00,040: DEBUG/MainProcess] Task accepted: boxing_console.tasks.refund_after_order_overdue[39978b5c-21cf-4fab-a44e-dd5bd5218de2] pid:250
(0.003) SELECT `course`.`id`, `course`.`boxer_id`, `course`.`course_name`, `course`.`price`, `course`.`duration`, `course`.`validity`, `course`.`club_id`, `course`.`is_open`, `course`.`is_deleted` FROM `course` WHERE `course`.`id` = 15; args=(15,)
[2018-09-18 17:55:00,046: DEBUG/ForkPoolWorker-3] (0.003) SELECT `course`.`id`, `course`.`boxer_id`, `course`.`course_name`, `course`.`price`, `course`.`duration`, `course`.`validity`, `course`.`club_id`, `course`.`is_open`, `course`.`is_deleted` FROM `course` WHERE `course`.`id` = 15; args=(15,)
(0.001) SET SESSION TRANSACTION ISOLATION LEVEL READ COMMITTED; args=None
[2018-09-18 17:55:00,048: DEBUG/ForkPoolWorker-4] (0.001) SET SESSION TRANSACTION ISOLATION LEVEL READ COMMITTED; args=None
(0.003) SELECT `pay_order`.`id`, `pay_order`.`user_id`, `pay_order`.`content_type_id`, `pay_order`.`object_id`, `pay_order`.`status`, `pay_order`.`out_trade_no`, `pay_order`.`payment_type`, `pay_order`.`amount`, `pay_order`.`device`, `pay_order`.`order_time`, `pay_order`.`pay_time`, `pay_order`.`finish_time` FROM `pay_order` WHERE `pay_order`.`id` = 67; args=(67,)
[2018-09-18 17:55:00,051: DEBUG/ForkPoolWorker-3] (0.003) SELECT `pay_order`.`id`, `pay_order`.`user_id`, `pay_order`.`content_type_id`, `pay_order`.`object_id`, `pay_order`.`status`, `pay_order`.`out_trade_no`, `pay_order`.`payment_type`, `pay_order`.`amount`, `pay_order`.`device`, `pay_order`.`order_time`, `pay_order`.`pay_time`, `pay_order`.`finish_time` FROM `pay_order` WHERE `pay_order`.`id` = 67; args=(67,)
(0.006) SELECT `course_order`.`id`, `course_order`.`pay_order_id`, `course_order`.`boxer_id`, `course_order`.`user_id`, `course_order`.`club_id`, `course_order`.`course_id`, `course_order`.`course_name`, `course_order`.`course_price`, `course_order`.`course_duration`, `course_order`.`course_validity`, `course_order`.`order_number`, `course_order`.`status`, `course_order`.`order_time`, `course_order`.`pay_time`, `course_order`.`confirm_status`, `course_order`.`boxer_confirm_time`, `course_order`.`user_confirm_time`, `course_order`.`finish_time`, `course_order`.`amount`, `course_order`.`insurance_amount`, `course_order`.`refund_record_id`, `course_order`.`is_deleted` FROM `course_order` WHERE (`course_order`.`is_deleted` = 0 AND `course_order`.`course_validity` < '2018-09-18' AND `course_order`.`refund_record_id` IS NULL AND `course_order`.`status` = 5) ORDER BY `course_order`.`order_time` DESC; args=(False, '2018-09-18', 5)
[2018-09-18 17:55:00,054: DEBUG/ForkPoolWorker-4] (0.006) SELECT `course_order`.`id`, `course_order`.`pay_order_id`, `course_order`.`boxer_id`, `course_order`.`user_id`, `course_order`.`club_id`, `course_order`.`course_id`, `course_order`.`course_name`, `course_order`.`course_price`, `course_order`.`course_duration`, `course_order`.`course_validity`, `course_order`.`order_number`, `course_order`.`status`, `course_order`.`order_time`, `course_order`.`pay_time`, `course_order`.`confirm_status`, `course_order`.`boxer_confirm_time`, `course_order`.`user_confirm_time`, `course_order`.`finish_time`, `course_order`.`amount`, `course_order`.`insurance_amount`, `course_order`.`refund_record_id`, `course_order`.`is_deleted` FROM `course_order` WHERE (`course_order`.`is_deleted` = 0 AND `course_order`.`course_validity` < '2018-09-18' AND `course_order`.`refund_record_id` IS NULL AND `course_order`.`status` = 5) ORDER BY `course_order`.`order_time` DESC; args=(False, '2018-09-18', 5)
(0.002) SELECT `course_settle_order`.`id`, `course_settle_order`.`order_id`, `course_settle_order`.`course_id`, `course_settle_order`.`course_order_id`, `course_settle_order`.`created_time`, `course_settle_order`.`settled`, `course_settle_order`.`settled_date`, `course_settle_order`.`settled_amount` FROM `course_settle_order` WHERE (`course_settle_order`.`course_id` = 15 AND `course_settle_order`.`course_order_id` = 36 AND `course_settle_order`.`order_id` = 67); args=(15, 36, 67)
[2018-09-18 17:55:00,057: DEBUG/ForkPoolWorker-3] (0.002) SELECT `course_settle_order`.`id`, `course_settle_order`.`order_id`, `course_settle_order`.`course_id`, `course_settle_order`.`course_order_id`, `course_settle_order`.`created_time`, `course_settle_order`.`settled`, `course_settle_order`.`settled_date`, `course_settle_order`.`settled_amount` FROM `course_settle_order` WHERE (`course_settle_order`.`course_id` = 15 AND `course_settle_order`.`course_order_id` = 36 AND `course_settle_order`.`order_id` = 67); args=(15, 36, 67)
(0.001) SELECT `course`.`id`, `course`.`boxer_id`, `course`.`course_name`, `course`.`price`, `course`.`duration`, `course`.`validity`, `course`.`club_id`, `course`.`is_open`, `course`.`is_deleted` FROM `course` WHERE `course`.`id` = 15; args=(15,)
[2018-09-18 17:55:00,061: DEBUG/ForkPoolWorker-3] (0.001) SELECT `course`.`id`, `course`.`boxer_id`, `course`.`course_name`, `course`.`price`, `course`.`duration`, `course`.`validity`, `course`.`club_id`, `course`.`is_open`, `course`.`is_deleted` FROM `course` WHERE `course`.`id` = 15; args=(15,)
(0.002) SELECT `pay_order`.`id`, `pay_order`.`user_id`, `pay_order`.`content_type_id`, `pay_order`.`object_id`, `pay_order`.`status`, `pay_order`.`out_trade_no`, `pay_order`.`payment_type`, `pay_order`.`amount`, `pay_order`.`device`, `pay_order`.`order_time`, `pay_order`.`pay_time`, `pay_order`.`finish_time` FROM `pay_order` WHERE `pay_order`.`id` = 15; args=(15,)
[2018-09-18 17:55:00,066: DEBUG/ForkPoolWorker-3] (0.002) SELECT `pay_order`.`id`, `pay_order`.`user_id`, `pay_order`.`content_type_id`, `pay_order`.`object_id`, `pay_order`.`status`, `pay_order`.`out_trade_no`, `pay_order`.`payment_type`, `pay_order`.`amount`, `pay_order`.`device`, `pay_order`.`order_time`, `pay_order`.`pay_time`, `pay_order`.`finish_time` FROM `pay_order` WHERE `pay_order`.`id` = 15; args=(15,)
[2018-09-18 17:55:00,067: DEBUG/ForkPoolWorker-4] Sending message of length 2930 to http://39.104.180.65/api/2/store/
[2018-09-18 17:55:00,068: ERROR/ForkPoolWorker-4] Task boxing_console.tasks.refund_after_order_overdue[39978b5c-21cf-4fab-a44e-dd5bd5218de2] raised unexpected: TypeError("unsupported operand type(s) for -: 'NoneType' and 'int'")
Traceback (most recent call last):
  File "/usr/local/lib/python3.7/site-packages/celery/app/trace.py", line 382, in trace_task
    R = retval = fun(*args, **kwargs)
  File "/usr/local/lib/python3.7/site-packages/celery/app/trace.py", line 641, in __protected_call__
    return self.run(*args, **kwargs)
  File "/work/boxing_console/tasks.py", line 52, in refund_after_order_overdue
    return_amount = course_order.amount - insurance_amount
TypeError: unsupported operand type(s) for -: 'NoneType' and 'int'
(0.002) SELECT `course_settle_order`.`id`, `course_settle_order`.`order_id`, `course_settle_order`.`course_id`, `course_settle_order`.`course_order_id`, `course_settle_order`.`created_time`, `course_settle_order`.`settled`, `course_settle_order`.`settled_date`, `course_settle_order`.`settled_amount` FROM `course_settle_order` WHERE (`course_settle_order`.`course_id` = 15 AND `course_settle_order`.`course_order_id` = 8 AND `course_settle_order`.`order_id` = 15); args=(15, 8, 15)
[2018-09-18 17:55:00,071: DEBUG/ForkPoolWorker-3] (0.002) SELECT `course_settle_order`.`id`, `course_settle_order`.`order_id`, `course_settle_order`.`course_id`, `course_settle_order`.`course_order_id`, `course_settle_order`.`created_time`, `course_settle_order`.`settled`, `course_settle_order`.`settled_date`, `course_settle_order`.`settled_amount` FROM `course_settle_order` WHERE (`course_settle_order`.`course_id` = 15 AND `course_settle_order`.`course_order_id` = 8 AND `course_settle_order`.`order_id` = 15); args=(15, 8, 15)
(0.001) UPDATE `course_order` SET `status` = 3 WHERE (`course_order`.`is_deleted` = 0 AND `course_order`.`boxer_confirm_time` < '2018-09-18 09:50:00.017445' AND `course_order`.`confirm_status` = 2); args=(3, False, '2018-09-18 09:50:00.017445', 2)
[2018-09-18 17:55:00,074: DEBUG/ForkPoolWorker-3] (0.001) UPDATE `course_order` SET `status` = 3 WHERE (`course_order`.`is_deleted` = 0 AND `course_order`.`boxer_confirm_time` < '2018-09-18 09:50:00.017445' AND `course_order`.`confirm_status` = 2); args=(3, False, '2018-09-18 09:50:00.017445', 2)
[2018-09-18 17:55:00,078: INFO/ForkPoolWorker-3] Task boxing_console.tasks.order_tear_finished_after_boxer_confirmed[50a21302-4812-4bf1-a55d-69b15cdf98cb] succeeded in 0.06162098999993759s: None
[2018-09-18 17:56:00,008: INFO/MainProcess] Received task: boxing_console.tasks.refund_after_order_overdue[92e0b857-c1e8-4c0e-b5a0-d046ae234ca4]  
[2018-09-18 17:56:00,009: DEBUG/MainProcess] TaskPool: Apply <function _fast_trace_task at 0x7fadec10d620> (args:('boxing_console.tasks.refund_after_order_overdue', '92e0b857-c1e8-4c0e-b5a0-d046ae234ca4', {'lang': 'py', 'task': 'boxing_console.tasks.refund_after_order_overdue', 'id': '92e0b857-c1e8-4c0e-b5a0-d046ae234ca4', 'shadow': None, 'eta': None, 'expires': None, 'group': None, 'retries': 0, 'timelimit': [None, None], 'root_id': '92e0b857-c1e8-4c0e-b5a0-d046ae234ca4', 'parent_id': None, 'argsrepr': '()', 'kwargsrepr': '{}', 'origin': 'gen216@7b8d459fb4db', 'reply_to': '26979d60-d808-3d32-bcd7-c6f48a392674', 'correlation_id': '92e0b857-c1e8-4c0e-b5a0-d046ae234ca4', 'delivery_info': {'exchange': '', 'routing_key': 'celery', 'priority': 0, 'redelivered': None}}, b'[[], {}, {"callbacks": null, "errbacks": null, "chain": null, "chord": null}]', 'application/json', 'utf-8') kwargs:{})
[2018-09-18 17:56:00,010: DEBUG/MainProcess] Task accepted: boxing_console.tasks.refund_after_order_overdue[92e0b857-c1e8-4c0e-b5a0-d046ae234ca4] pid:249
[2018-09-18 17:56:00,022: INFO/MainProcess] Received task: boxing_console.tasks.order_tear_finished_after_boxer_confirmed[9f94c900-bd24-46a0-aed2-cc210921cea4]  
[2018-09-18 17:56:00,022: DEBUG/MainProcess] TaskPool: Apply <function _fast_trace_task at 0x7fadec10d620> (args:('boxing_console.tasks.order_tear_finished_after_boxer_confirmed', '9f94c900-bd24-46a0-aed2-cc210921cea4', {'lang': 'py', 'task': 'boxing_console.tasks.order_tear_finished_after_boxer_confirmed', 'id': '9f94c900-bd24-46a0-aed2-cc210921cea4', 'shadow': None, 'eta': None, 'expires': None, 'group': None, 'retries': 0, 'timelimit': [None, None], 'root_id': '9f94c900-bd24-46a0-aed2-cc210921cea4', 'parent_id': None, 'argsrepr': '()', 'kwargsrepr': '{}', 'origin': 'gen216@7b8d459fb4db', 'reply_to': '26979d60-d808-3d32-bcd7-c6f48a392674', 'correlation_id': '9f94c900-bd24-46a0-aed2-cc210921cea4', 'delivery_info': {'exchange': '', 'routing_key': 'celery', 'priority': 0, 'redelivered': None}}, b'[[], {}, {"callbacks": null, "errbacks": null, "chain": null, "chord": null}]', 'application/json', 'utf-8') kwargs:{})
[2018-09-18 17:56:00,024: DEBUG/MainProcess] Task accepted: boxing_console.tasks.order_tear_finished_after_boxer_confirmed[9f94c900-bd24-46a0-aed2-cc210921cea4] pid:250
[2018-09-18 17:56:00,025: WARNING/ForkPoolWorker-4] /usr/local/lib/python3.7/site-packages/django/db/models/fields/__init__.py:1423: RuntimeWarning: DateTimeField CourseOrder.boxer_confirm_time received a naive datetime (2018-09-18 17:51:00.024207) while time zone support is active.
  RuntimeWarning)
(0.008) SELECT `course_order`.`id`, `course_order`.`pay_order_id`, `course_order`.`boxer_id`, `course_order`.`user_id`, `course_order`.`club_id`, `course_order`.`course_id`, `course_order`.`course_name`, `course_order`.`course_price`, `course_order`.`course_duration`, `course_order`.`course_validity`, `course_order`.`order_number`, `course_order`.`status`, `course_order`.`order_time`, `course_order`.`pay_time`, `course_order`.`confirm_status`, `course_order`.`boxer_confirm_time`, `course_order`.`user_confirm_time`, `course_order`.`finish_time`, `course_order`.`amount`, `course_order`.`insurance_amount`, `course_order`.`refund_record_id`, `course_order`.`is_deleted` FROM `course_order` WHERE (`course_order`.`is_deleted` = 0 AND `course_order`.`course_validity` < '2018-09-18' AND `course_order`.`refund_record_id` IS NULL AND `course_order`.`status` = 5) ORDER BY `course_order`.`order_time` DESC; args=(False, '2018-09-18', 5)
[2018-09-18 17:56:00,020: DEBUG/ForkPoolWorker-3] (0.008) SELECT `course_order`.`id`, `course_order`.`pay_order_id`, `course_order`.`boxer_id`, `course_order`.`user_id`, `course_order`.`club_id`, `course_order`.`course_id`, `course_order`.`course_name`, `course_order`.`course_price`, `course_order`.`course_duration`, `course_order`.`course_validity`, `course_order`.`order_number`, `course_order`.`status`, `course_order`.`order_time`, `course_order`.`pay_time`, `course_order`.`confirm_status`, `course_order`.`boxer_confirm_time`, `course_order`.`user_confirm_time`, `course_order`.`finish_time`, `course_order`.`amount`, `course_order`.`insurance_amount`, `course_order`.`refund_record_id`, `course_order`.`is_deleted` FROM `course_order` WHERE (`course_order`.`is_deleted` = 0 AND `course_order`.`course_validity` < '2018-09-18' AND `course_order`.`refund_record_id` IS NULL AND `course_order`.`status` = 5) ORDER BY `course_order`.`order_time` DESC; args=(False, '2018-09-18', 5)
(0.003) SELECT `course_order`.`id`, `course_order`.`pay_order_id`, `course_order`.`boxer_id`, `course_order`.`user_id`, `course_order`.`club_id`, `course_order`.`course_id`, `course_order`.`course_name`, `course_order`.`course_price`, `course_order`.`course_duration`, `course_order`.`course_validity`, `course_order`.`order_number`, `course_order`.`status`, `course_order`.`order_time`, `course_order`.`pay_time`, `course_order`.`confirm_status`, `course_order`.`boxer_confirm_time`, `course_order`.`user_confirm_time`, `course_order`.`finish_time`, `course_order`.`amount`, `course_order`.`insurance_amount`, `course_order`.`refund_record_id`, `course_order`.`is_deleted` FROM `course_order` WHERE (`course_order`.`is_deleted` = 0 AND `course_order`.`boxer_confirm_time` < '2018-09-18 09:51:00.024207' AND `course_order`.`confirm_status` = 2) ORDER BY `course_order`.`order_time` DESC; args=(False, '2018-09-18 09:51:00.024207', 2)
[2018-09-18 17:56:00,030: DEBUG/ForkPoolWorker-4] (0.003) SELECT `course_order`.`id`, `course_order`.`pay_order_id`, `course_order`.`boxer_id`, `course_order`.`user_id`, `course_order`.`club_id`, `course_order`.`course_id`, `course_order`.`course_name`, `course_order`.`course_price`, `course_order`.`course_duration`, `course_order`.`course_validity`, `course_order`.`order_number`, `course_order`.`status`, `course_order`.`order_time`, `course_order`.`pay_time`, `course_order`.`confirm_status`, `course_order`.`boxer_confirm_time`, `course_order`.`user_confirm_time`, `course_order`.`finish_time`, `course_order`.`amount`, `course_order`.`insurance_amount`, `course_order`.`refund_record_id`, `course_order`.`is_deleted` FROM `course_order` WHERE (`course_order`.`is_deleted` = 0 AND `course_order`.`boxer_confirm_time` < '2018-09-18 09:51:00.024207' AND `course_order`.`confirm_status` = 2) ORDER BY `course_order`.`order_time` DESC; args=(False, '2018-09-18 09:51:00.024207', 2)
(0.002) SELECT `course`.`id`, `course`.`boxer_id`, `course`.`course_name`, `course`.`price`, `course`.`duration`, `course`.`validity`, `course`.`club_id`, `course`.`is_open`, `course`.`is_deleted` FROM `course` WHERE `course`.`id` = 15; args=(15,)
[2018-09-18 17:56:00,035: DEBUG/ForkPoolWorker-4] (0.002) SELECT `course`.`id`, `course`.`boxer_id`, `course`.`course_name`, `course`.`price`, `course`.`duration`, `course`.`validity`, `course`.`club_id`, `course`.`is_open`, `course`.`is_deleted` FROM `course` WHERE `course`.`id` = 15; args=(15,)
(0.001) SELECT `pay_order`.`id`, `pay_order`.`user_id`, `pay_order`.`content_type_id`, `pay_order`.`object_id`, `pay_order`.`status`, `pay_order`.`out_trade_no`, `pay_order`.`payment_type`, `pay_order`.`amount`, `pay_order`.`device`, `pay_order`.`order_time`, `pay_order`.`pay_time`, `pay_order`.`finish_time` FROM `pay_order` WHERE `pay_order`.`id` = 67; args=(67,)
[2018-09-18 17:56:00,038: DEBUG/ForkPoolWorker-4] (0.001) SELECT `pay_order`.`id`, `pay_order`.`user_id`, `pay_order`.`content_type_id`, `pay_order`.`object_id`, `pay_order`.`status`, `pay_order`.`out_trade_no`, `pay_order`.`payment_type`, `pay_order`.`amount`, `pay_order`.`device`, `pay_order`.`order_time`, `pay_order`.`pay_time`, `pay_order`.`finish_time` FROM `pay_order` WHERE `pay_order`.`id` = 67; args=(67,)
[2018-09-18 17:56:00,039: DEBUG/ForkPoolWorker-3] Sending message of length 2874 to http://39.104.180.65/api/2/store/
[2018-09-18 17:56:00,039: ERROR/ForkPoolWorker-3] Task boxing_console.tasks.refund_after_order_overdue[92e0b857-c1e8-4c0e-b5a0-d046ae234ca4] raised unexpected: TypeError("unsupported operand type(s) for -: 'NoneType' and 'int'")
Traceback (most recent call last):
  File "/usr/local/lib/python3.7/site-packages/celery/app/trace.py", line 382, in trace_task
    R = retval = fun(*args, **kwargs)
  File "/usr/local/lib/python3.7/site-packages/celery/app/trace.py", line 641, in __protected_call__
    return self.run(*args, **kwargs)
  File "/work/boxing_console/tasks.py", line 52, in refund_after_order_overdue
    return_amount = course_order.amount - insurance_amount
TypeError: unsupported operand type(s) for -: 'NoneType' and 'int'
(0.002) SELECT `course_settle_order`.`id`, `course_settle_order`.`order_id`, `course_settle_order`.`course_id`, `course_settle_order`.`course_order_id`, `course_settle_order`.`created_time`, `course_settle_order`.`settled`, `course_settle_order`.`settled_date`, `course_settle_order`.`settled_amount` FROM `course_settle_order` WHERE (`course_settle_order`.`course_id` = 15 AND `course_settle_order`.`course_order_id` = 36 AND `course_settle_order`.`order_id` = 67); args=(15, 36, 67)
[2018-09-18 17:56:00,043: DEBUG/ForkPoolWorker-4] (0.002) SELECT `course_settle_order`.`id`, `course_settle_order`.`order_id`, `course_settle_order`.`course_id`, `course_settle_order`.`course_order_id`, `course_settle_order`.`created_time`, `course_settle_order`.`settled`, `course_settle_order`.`settled_date`, `course_settle_order`.`settled_amount` FROM `course_settle_order` WHERE (`course_settle_order`.`course_id` = 15 AND `course_settle_order`.`course_order_id` = 36 AND `course_settle_order`.`order_id` = 67); args=(15, 36, 67)
(0.001) SELECT `course`.`id`, `course`.`boxer_id`, `course`.`course_name`, `course`.`price`, `course`.`duration`, `course`.`validity`, `course`.`club_id`, `course`.`is_open`, `course`.`is_deleted` FROM `course` WHERE `course`.`id` = 15; args=(15,)
[2018-09-18 17:56:00,045: DEBUG/ForkPoolWorker-4] (0.001) SELECT `course`.`id`, `course`.`boxer_id`, `course`.`course_name`, `course`.`price`, `course`.`duration`, `course`.`validity`, `course`.`club_id`, `course`.`is_open`, `course`.`is_deleted` FROM `course` WHERE `course`.`id` = 15; args=(15,)
(0.001) SELECT `pay_order`.`id`, `pay_order`.`user_id`, `pay_order`.`content_type_id`, `pay_order`.`object_id`, `pay_order`.`status`, `pay_order`.`out_trade_no`, `pay_order`.`payment_type`, `pay_order`.`amount`, `pay_order`.`device`, `pay_order`.`order_time`, `pay_order`.`pay_time`, `pay_order`.`finish_time` FROM `pay_order` WHERE `pay_order`.`id` = 15; args=(15,)
[2018-09-18 17:56:00,047: DEBUG/ForkPoolWorker-4] (0.001) SELECT `pay_order`.`id`, `pay_order`.`user_id`, `pay_order`.`content_type_id`, `pay_order`.`object_id`, `pay_order`.`status`, `pay_order`.`out_trade_no`, `pay_order`.`payment_type`, `pay_order`.`amount`, `pay_order`.`device`, `pay_order`.`order_time`, `pay_order`.`pay_time`, `pay_order`.`finish_time` FROM `pay_order` WHERE `pay_order`.`id` = 15; args=(15,)
(0.001) SELECT `course_settle_order`.`id`, `course_settle_order`.`order_id`, `course_settle_order`.`course_id`, `course_settle_order`.`course_order_id`, `course_settle_order`.`created_time`, `course_settle_order`.`settled`, `course_settle_order`.`settled_date`, `course_settle_order`.`settled_amount` FROM `course_settle_order` WHERE (`course_settle_order`.`course_id` = 15 AND `course_settle_order`.`course_order_id` = 8 AND `course_settle_order`.`order_id` = 15); args=(15, 8, 15)
[2018-09-18 17:56:00,050: DEBUG/ForkPoolWorker-4] (0.001) SELECT `course_settle_order`.`id`, `course_settle_order`.`order_id`, `course_settle_order`.`course_id`, `course_settle_order`.`course_order_id`, `course_settle_order`.`created_time`, `course_settle_order`.`settled`, `course_settle_order`.`settled_date`, `course_settle_order`.`settled_amount` FROM `course_settle_order` WHERE (`course_settle_order`.`course_id` = 15 AND `course_settle_order`.`course_order_id` = 8 AND `course_settle_order`.`order_id` = 15); args=(15, 8, 15)
(0.001) UPDATE `course_order` SET `status` = 3 WHERE (`course_order`.`is_deleted` = 0 AND `course_order`.`boxer_confirm_time` < '2018-09-18 09:51:00.024207' AND `course_order`.`confirm_status` = 2); args=(3, False, '2018-09-18 09:51:00.024207', 2)
[2018-09-18 17:56:00,053: DEBUG/ForkPoolWorker-4] (0.001) UPDATE `course_order` SET `status` = 3 WHERE (`course_order`.`is_deleted` = 0 AND `course_order`.`boxer_confirm_time` < '2018-09-18 09:51:00.024207' AND `course_order`.`confirm_status` = 2); args=(3, False, '2018-09-18 09:51:00.024207', 2)
[2018-09-18 17:56:00,056: INFO/ForkPoolWorker-4] Task boxing_console.tasks.order_tear_finished_after_boxer_confirmed[9f94c900-bd24-46a0-aed2-cc210921cea4] succeeded in 0.03218495600231108s: None
[2018-09-18 17:56:28,840: INFO/MainProcess] Received task: boxing_app.tasks.incr_hot_video_views_count[0ae65092-5f14-446b-ac84-203a05237e41]  
[2018-09-18 17:56:28,841: DEBUG/MainProcess] TaskPool: Apply <function _fast_trace_task at 0x7fadec10d620> (args:('boxing_app.tasks.incr_hot_video_views_count', '0ae65092-5f14-446b-ac84-203a05237e41', {'lang': 'py', 'task': 'boxing_app.tasks.incr_hot_video_views_count', 'id': '0ae65092-5f14-446b-ac84-203a05237e41', 'shadow': None, 'eta': None, 'expires': None, 'group': None, 'retries': 0, 'timelimit': [None, None], 'root_id': '0ae65092-5f14-446b-ac84-203a05237e41', 'parent_id': None, 'argsrepr': '(3,)', 'kwargsrepr': '{}', 'origin': 'gen55175@ningleideMacBook-Pro.local', 'reply_to': 'c8cad723-41dc-311f-835d-2330a4f92a67', 'correlation_id': '0ae65092-5f14-446b-ac84-203a05237e41', 'delivery_info': {'exchange': '', 'routing_key': 'celery', 'priority': 0, 'redelivered': None}}, b'[[3], {}, {"callbacks": null, "errbacks": null, "chain": null, "chord": null}]', 'application/json', 'utf-8') kwargs:{})
[2018-09-18 17:56:28,842: DEBUG/MainProcess] Task accepted: boxing_app.tasks.incr_hot_video_views_count[0ae65092-5f14-446b-ac84-203a05237e41] pid:249
(0.001) UPDATE `hot_video` SET `views_count` = (`hot_video`.`views_count` + 1) WHERE `hot_video`.`id` = 3; args=(1, 3)
[2018-09-18 17:56:28,844: DEBUG/ForkPoolWorker-3] (0.001) UPDATE `hot_video` SET `views_count` = (`hot_video`.`views_count` + 1) WHERE `hot_video`.`id` = 3; args=(1, 3)
[2018-09-18 17:56:28,846: INFO/ForkPoolWorker-3] Task boxing_app.tasks.incr_hot_video_views_count[0ae65092-5f14-446b-ac84-203a05237e41] succeeded in 0.0036717319999297615s: None
[2018-09-18 17:56:29,993: INFO/MainProcess] Received task: boxing_app.tasks.incr_hot_video_views_count[0b3e478d-aacd-4ae9-8d90-a9a98887eab7]  
[2018-09-18 17:56:29,993: DEBUG/MainProcess] TaskPool: Apply <function _fast_trace_task at 0x7fadec10d620> (args:('boxing_app.tasks.incr_hot_video_views_count', '0b3e478d-aacd-4ae9-8d90-a9a98887eab7', {'lang': 'py', 'task': 'boxing_app.tasks.incr_hot_video_views_count', 'id': '0b3e478d-aacd-4ae9-8d90-a9a98887eab7', 'shadow': None, 'eta': None, 'expires': None, 'group': None, 'retries': 0, 'timelimit': [None, None], 'root_id': '0b3e478d-aacd-4ae9-8d90-a9a98887eab7', 'parent_id': None, 'argsrepr': '(7,)', 'kwargsrepr': '{}', 'origin': 'gen55175@ningleideMacBook-Pro.local', 'reply_to': 'c8cad723-41dc-311f-835d-2330a4f92a67', 'correlation_id': '0b3e478d-aacd-4ae9-8d90-a9a98887eab7', 'delivery_info': {'exchange': '', 'routing_key': 'celery', 'priority': 0, 'redelivered': None}}, b'[[7], {}, {"callbacks": null, "errbacks": null, "chain": null, "chord": null}]', 'application/json', 'utf-8') kwargs:{})
[2018-09-18 17:56:29,994: DEBUG/MainProcess] Task accepted: boxing_app.tasks.incr_hot_video_views_count[0b3e478d-aacd-4ae9-8d90-a9a98887eab7] pid:250
(0.001) UPDATE `hot_video` SET `views_count` = (`hot_video`.`views_count` + 1) WHERE `hot_video`.`id` = 7; args=(1, 7)
[2018-09-18 17:56:29,996: DEBUG/ForkPoolWorker-4] (0.001) UPDATE `hot_video` SET `views_count` = (`hot_video`.`views_count` + 1) WHERE `hot_video`.`id` = 7; args=(1, 7)
[2018-09-18 17:56:29,997: INFO/ForkPoolWorker-4] Task boxing_app.tasks.incr_hot_video_views_count[0b3e478d-aacd-4ae9-8d90-a9a98887eab7] succeeded in 0.003329337003378896s: None
[2018-09-18 17:56:35,153: INFO/MainProcess] Received task: boxing_app.tasks.register_easemob_account[c425820d-fff4-4110-8233-76aeca899c08]  
[2018-09-18 17:56:35,154: DEBUG/MainProcess] TaskPool: Apply <function _fast_trace_task at 0x7fadec10d620> (args:('boxing_app.tasks.register_easemob_account', 'c425820d-fff4-4110-8233-76aeca899c08', {'lang': 'py', 'task': 'boxing_app.tasks.register_easemob_account', 'id': 'c425820d-fff4-4110-8233-76aeca899c08', 'shadow': None, 'eta': None, 'expires': None, 'group': None, 'retries': 0, 'timelimit': [None, None], 'root_id': 'c425820d-fff4-4110-8233-76aeca899c08', 'parent_id': None, 'argsrepr': '(162,)', 'kwargsrepr': '{}', 'origin': 'gen55175@ningleideMacBook-Pro.local', 'reply_to': 'c8cad723-41dc-311f-835d-2330a4f92a67', 'correlation_id': 'c425820d-fff4-4110-8233-76aeca899c08', 'delivery_info': {'exchange': '', 'routing_key': 'celery', 'priority': 0, 'redelivered': None}}, b'[[162], {}, {"callbacks": null, "errbacks": null, "chain": null, "chord": null}]', 'application/json', 'utf-8') kwargs:{})
[2018-09-18 17:56:35,155: DEBUG/MainProcess] Task accepted: boxing_app.tasks.register_easemob_account[c425820d-fff4-4110-8233-76aeca899c08] pid:249
[2018-09-18 17:56:35,157: DEBUG/ForkPoolWorker-3] Starting new HTTPS connection (1): a1.easemob.com:443
[2018-09-18 17:56:35,209: DEBUG/ForkPoolWorker-3] https://a1.easemob.com:443 "POST /douqu/boxing-test/users HTTP/1.1" 429 None
[2018-09-18 17:56:35,214: DEBUG/ForkPoolWorker-3] Starting new HTTPS connection (1): a1.easemob.com:443
[2018-09-18 17:56:35,263: DEBUG/ForkPoolWorker-3] https://a1.easemob.com:443 "POST /douqu/boxing-test/messages HTTP/1.1" 200 None
[2018-09-18 17:56:35,265: INFO/ForkPoolWorker-3] Task boxing_app.tasks.register_easemob_account[c425820d-fff4-4110-8233-76aeca899c08] succeeded in 0.1105678740022995s: <Response [200]>
[2018-09-18 17:57:00,004: INFO/MainProcess] Received task: boxing_console.tasks.order_tear_finished_after_boxer_confirmed[4f375101-4102-44c3-8b47-36a1dc869ff7]  
[2018-09-18 17:57:00,004: DEBUG/MainProcess] TaskPool: Apply <function _fast_trace_task at 0x7fadec10d620> (args:('boxing_console.tasks.order_tear_finished_after_boxer_confirmed', '4f375101-4102-44c3-8b47-36a1dc869ff7', {'lang': 'py', 'task': 'boxing_console.tasks.order_tear_finished_after_boxer_confirmed', 'id': '4f375101-4102-44c3-8b47-36a1dc869ff7', 'shadow': None, 'eta': None, 'expires': None, 'group': None, 'retries': 0, 'timelimit': [None, None], 'root_id': '4f375101-4102-44c3-8b47-36a1dc869ff7', 'parent_id': None, 'argsrepr': '()', 'kwargsrepr': '{}', 'origin': 'gen216@7b8d459fb4db', 'reply_to': '26979d60-d808-3d32-bcd7-c6f48a392674', 'correlation_id': '4f375101-4102-44c3-8b47-36a1dc869ff7', 'delivery_info': {'exchange': '', 'routing_key': 'celery', 'priority': 0, 'redelivered': None}}, b'[[], {}, {"callbacks": null, "errbacks": null, "chain": null, "chord": null}]', 'application/json', 'utf-8') kwargs:{})
[2018-09-18 17:57:00,006: WARNING/ForkPoolWorker-4] /usr/local/lib/python3.7/site-packages/django/db/models/fields/__init__.py:1423: RuntimeWarning: DateTimeField CourseOrder.boxer_confirm_time received a naive datetime (2018-09-18 17:52:00.006068) while time zone support is active.
  RuntimeWarning)
[2018-09-18 17:57:00,006: DEBUG/MainProcess] Task accepted: boxing_console.tasks.order_tear_finished_after_boxer_confirmed[4f375101-4102-44c3-8b47-36a1dc869ff7] pid:250
(0.002) SELECT `course_order`.`id`, `course_order`.`pay_order_id`, `course_order`.`boxer_id`, `course_order`.`user_id`, `course_order`.`club_id`, `course_order`.`course_id`, `course_order`.`course_name`, `course_order`.`course_price`, `course_order`.`course_duration`, `course_order`.`course_validity`, `course_order`.`order_number`, `course_order`.`status`, `course_order`.`order_time`, `course_order`.`pay_time`, `course_order`.`confirm_status`, `course_order`.`boxer_confirm_time`, `course_order`.`user_confirm_time`, `course_order`.`finish_time`, `course_order`.`amount`, `course_order`.`insurance_amount`, `course_order`.`refund_record_id`, `course_order`.`is_deleted` FROM `course_order` WHERE (`course_order`.`is_deleted` = 0 AND `course_order`.`boxer_confirm_time` < '2018-09-18 09:52:00.006068' AND `course_order`.`confirm_status` = 2) ORDER BY `course_order`.`order_time` DESC; args=(False, '2018-09-18 09:52:00.006068', 2)
[2018-09-18 17:57:00,009: DEBUG/ForkPoolWorker-4] (0.002) SELECT `course_order`.`id`, `course_order`.`pay_order_id`, `course_order`.`boxer_id`, `course_order`.`user_id`, `course_order`.`club_id`, `course_order`.`course_id`, `course_order`.`course_name`, `course_order`.`course_price`, `course_order`.`course_duration`, `course_order`.`course_validity`, `course_order`.`order_number`, `course_order`.`status`, `course_order`.`order_time`, `course_order`.`pay_time`, `course_order`.`confirm_status`, `course_order`.`boxer_confirm_time`, `course_order`.`user_confirm_time`, `course_order`.`finish_time`, `course_order`.`amount`, `course_order`.`insurance_amount`, `course_order`.`refund_record_id`, `course_order`.`is_deleted` FROM `course_order` WHERE (`course_order`.`is_deleted` = 0 AND `course_order`.`boxer_confirm_time` < '2018-09-18 09:52:00.006068' AND `course_order`.`confirm_status` = 2) ORDER BY `course_order`.`order_time` DESC; args=(False, '2018-09-18 09:52:00.006068', 2)
(0.001) SELECT `course`.`id`, `course`.`boxer_id`, `course`.`course_name`, `course`.`price`, `course`.`duration`, `course`.`validity`, `course`.`club_id`, `course`.`is_open`, `course`.`is_deleted` FROM `course` WHERE `course`.`id` = 15; args=(15,)
[2018-09-18 17:57:00,011: DEBUG/ForkPoolWorker-4] (0.001) SELECT `course`.`id`, `course`.`boxer_id`, `course`.`course_name`, `course`.`price`, `course`.`duration`, `course`.`validity`, `course`.`club_id`, `course`.`is_open`, `course`.`is_deleted` FROM `course` WHERE `course`.`id` = 15; args=(15,)
(0.002) SELECT `pay_order`.`id`, `pay_order`.`user_id`, `pay_order`.`content_type_id`, `pay_order`.`object_id`, `pay_order`.`status`, `pay_order`.`out_trade_no`, `pay_order`.`payment_type`, `pay_order`.`amount`, `pay_order`.`device`, `pay_order`.`order_time`, `pay_order`.`pay_time`, `pay_order`.`finish_time` FROM `pay_order` WHERE `pay_order`.`id` = 67; args=(67,)
[2018-09-18 17:57:00,014: DEBUG/ForkPoolWorker-4] (0.002) SELECT `pay_order`.`id`, `pay_order`.`user_id`, `pay_order`.`content_type_id`, `pay_order`.`object_id`, `pay_order`.`status`, `pay_order`.`out_trade_no`, `pay_order`.`payment_type`, `pay_order`.`amount`, `pay_order`.`device`, `pay_order`.`order_time`, `pay_order`.`pay_time`, `pay_order`.`finish_time` FROM `pay_order` WHERE `pay_order`.`id` = 67; args=(67,)
(0.002) SELECT `course_settle_order`.`id`, `course_settle_order`.`order_id`, `course_settle_order`.`course_id`, `course_settle_order`.`course_order_id`, `course_settle_order`.`created_time`, `course_settle_order`.`settled`, `course_settle_order`.`settled_date`, `course_settle_order`.`settled_amount` FROM `course_settle_order` WHERE (`course_settle_order`.`course_id` = 15 AND `course_settle_order`.`course_order_id` = 36 AND `course_settle_order`.`order_id` = 67); args=(15, 36, 67)
[2018-09-18 17:57:00,018: DEBUG/ForkPoolWorker-4] (0.002) SELECT `course_settle_order`.`id`, `course_settle_order`.`order_id`, `course_settle_order`.`course_id`, `course_settle_order`.`course_order_id`, `course_settle_order`.`created_time`, `course_settle_order`.`settled`, `course_settle_order`.`settled_date`, `course_settle_order`.`settled_amount` FROM `course_settle_order` WHERE (`course_settle_order`.`course_id` = 15 AND `course_settle_order`.`course_order_id` = 36 AND `course_settle_order`.`order_id` = 67); args=(15, 36, 67)
(0.003) SELECT `course`.`id`, `course`.`boxer_id`, `course`.`course_name`, `course`.`price`, `course`.`duration`, `course`.`validity`, `course`.`club_id`, `course`.`is_open`, `course`.`is_deleted` FROM `course` WHERE `course`.`id` = 15; args=(15,)
[2018-09-18 17:57:00,022: DEBUG/ForkPoolWorker-4] (0.003) SELECT `course`.`id`, `course`.`boxer_id`, `course`.`course_name`, `course`.`price`, `course`.`duration`, `course`.`validity`, `course`.`club_id`, `course`.`is_open`, `course`.`is_deleted` FROM `course` WHERE `course`.`id` = 15; args=(15,)
[2018-09-18 17:57:00,023: INFO/MainProcess] Received task: boxing_console.tasks.refund_after_order_overdue[bd004561-a5f9-4048-b263-f69b4822018a]  
[2018-09-18 17:57:00,023: DEBUG/MainProcess] TaskPool: Apply <function _fast_trace_task at 0x7fadec10d620> (args:('boxing_console.tasks.refund_after_order_overdue', 'bd004561-a5f9-4048-b263-f69b4822018a', {'lang': 'py', 'task': 'boxing_console.tasks.refund_after_order_overdue', 'id': 'bd004561-a5f9-4048-b263-f69b4822018a', 'shadow': None, 'eta': None, 'expires': None, 'group': None, 'retries': 0, 'timelimit': [None, None], 'root_id': 'bd004561-a5f9-4048-b263-f69b4822018a', 'parent_id': None, 'argsrepr': '()', 'kwargsrepr': '{}', 'origin': 'gen216@7b8d459fb4db', 'reply_to': '26979d60-d808-3d32-bcd7-c6f48a392674', 'correlation_id': 'bd004561-a5f9-4048-b263-f69b4822018a', 'delivery_info': {'exchange': '', 'routing_key': 'celery', 'priority': 0, 'redelivered': None}}, b'[[], {}, {"callbacks": null, "errbacks": null, "chain": null, "chord": null}]', 'application/json', 'utf-8') kwargs:{})
[2018-09-18 17:57:00,024: DEBUG/MainProcess] Task accepted: boxing_console.tasks.refund_after_order_overdue[bd004561-a5f9-4048-b263-f69b4822018a] pid:249
(0.002) SELECT `pay_order`.`id`, `pay_order`.`user_id`, `pay_order`.`content_type_id`, `pay_order`.`object_id`, `pay_order`.`status`, `pay_order`.`out_trade_no`, `pay_order`.`payment_type`, `pay_order`.`amount`, `pay_order`.`device`, `pay_order`.`order_time`, `pay_order`.`pay_time`, `pay_order`.`finish_time` FROM `pay_order` WHERE `pay_order`.`id` = 15; args=(15,)
[2018-09-18 17:57:00,026: DEBUG/ForkPoolWorker-4] (0.002) SELECT `pay_order`.`id`, `pay_order`.`user_id`, `pay_order`.`content_type_id`, `pay_order`.`object_id`, `pay_order`.`status`, `pay_order`.`out_trade_no`, `pay_order`.`payment_type`, `pay_order`.`amount`, `pay_order`.`device`, `pay_order`.`order_time`, `pay_order`.`pay_time`, `pay_order`.`finish_time` FROM `pay_order` WHERE `pay_order`.`id` = 15; args=(15,)
(0.002) SELECT `course_settle_order`.`id`, `course_settle_order`.`order_id`, `course_settle_order`.`course_id`, `course_settle_order`.`course_order_id`, `course_settle_order`.`created_time`, `course_settle_order`.`settled`, `course_settle_order`.`settled_date`, `course_settle_order`.`settled_amount` FROM `course_settle_order` WHERE (`course_settle_order`.`course_id` = 15 AND `course_settle_order`.`course_order_id` = 8 AND `course_settle_order`.`order_id` = 15); args=(15, 8, 15)
[2018-09-18 17:57:00,030: DEBUG/ForkPoolWorker-4] (0.002) SELECT `course_settle_order`.`id`, `course_settle_order`.`order_id`, `course_settle_order`.`course_id`, `course_settle_order`.`course_order_id`, `course_settle_order`.`created_time`, `course_settle_order`.`settled`, `course_settle_order`.`settled_date`, `course_settle_order`.`settled_amount` FROM `course_settle_order` WHERE (`course_settle_order`.`course_id` = 15 AND `course_settle_order`.`course_order_id` = 8 AND `course_settle_order`.`order_id` = 15); args=(15, 8, 15)
(0.001) SET SESSION TRANSACTION ISOLATION LEVEL READ COMMITTED; args=None
[2018-09-18 17:57:00,032: DEBUG/ForkPoolWorker-3] (0.001) SET SESSION TRANSACTION ISOLATION LEVEL READ COMMITTED; args=None
(0.001) UPDATE `course_order` SET `status` = 3 WHERE (`course_order`.`is_deleted` = 0 AND `course_order`.`boxer_confirm_time` < '2018-09-18 09:52:00.006068' AND `course_order`.`confirm_status` = 2); args=(3, False, '2018-09-18 09:52:00.006068', 2)
[2018-09-18 17:57:00,032: DEBUG/ForkPoolWorker-4] (0.001) UPDATE `course_order` SET `status` = 3 WHERE (`course_order`.`is_deleted` = 0 AND `course_order`.`boxer_confirm_time` < '2018-09-18 09:52:00.006068' AND `course_order`.`confirm_status` = 2); args=(3, False, '2018-09-18 09:52:00.006068', 2)
(0.002) SELECT `course_order`.`id`, `course_order`.`pay_order_id`, `course_order`.`boxer_id`, `course_order`.`user_id`, `course_order`.`club_id`, `course_order`.`course_id`, `course_order`.`course_name`, `course_order`.`course_price`, `course_order`.`course_duration`, `course_order`.`course_validity`, `course_order`.`order_number`, `course_order`.`status`, `course_order`.`order_time`, `course_order`.`pay_time`, `course_order`.`confirm_status`, `course_order`.`boxer_confirm_time`, `course_order`.`user_confirm_time`, `course_order`.`finish_time`, `course_order`.`amount`, `course_order`.`insurance_amount`, `course_order`.`refund_record_id`, `course_order`.`is_deleted` FROM `course_order` WHERE (`course_order`.`is_deleted` = 0 AND `course_order`.`course_validity` < '2018-09-18' AND `course_order`.`refund_record_id` IS NULL AND `course_order`.`status` = 5) ORDER BY `course_order`.`order_time` DESC; args=(False, '2018-09-18', 5)
[2018-09-18 17:57:00,034: DEBUG/ForkPoolWorker-3] (0.002) SELECT `course_order`.`id`, `course_order`.`pay_order_id`, `course_order`.`boxer_id`, `course_order`.`user_id`, `course_order`.`club_id`, `course_order`.`course_id`, `course_order`.`course_name`, `course_order`.`course_price`, `course_order`.`course_duration`, `course_order`.`course_validity`, `course_order`.`order_number`, `course_order`.`status`, `course_order`.`order_time`, `course_order`.`pay_time`, `course_order`.`confirm_status`, `course_order`.`boxer_confirm_time`, `course_order`.`user_confirm_time`, `course_order`.`finish_time`, `course_order`.`amount`, `course_order`.`insurance_amount`, `course_order`.`refund_record_id`, `course_order`.`is_deleted` FROM `course_order` WHERE (`course_order`.`is_deleted` = 0 AND `course_order`.`course_validity` < '2018-09-18' AND `course_order`.`refund_record_id` IS NULL AND `course_order`.`status` = 5) ORDER BY `course_order`.`order_time` DESC; args=(False, '2018-09-18', 5)
[2018-09-18 17:57:00,037: INFO/ForkPoolWorker-4] Task boxing_console.tasks.order_tear_finished_after_boxer_confirmed[4f375101-4102-44c3-8b47-36a1dc869ff7] succeeded in 0.03160437000042293s: None
[2018-09-18 17:57:00,043: DEBUG/ForkPoolWorker-3] Sending message of length 2924 to http://39.104.180.65/api/2/store/
[2018-09-18 17:57:00,043: ERROR/ForkPoolWorker-3] Task boxing_console.tasks.refund_after_order_overdue[bd004561-a5f9-4048-b263-f69b4822018a] raised unexpected: TypeError("unsupported operand type(s) for -: 'NoneType' and 'int'")
Traceback (most recent call last):
  File "/usr/local/lib/python3.7/site-packages/celery/app/trace.py", line 382, in trace_task
    R = retval = fun(*args, **kwargs)
  File "/usr/local/lib/python3.7/site-packages/celery/app/trace.py", line 641, in __protected_call__
    return self.run(*args, **kwargs)
  File "/work/boxing_console/tasks.py", line 52, in refund_after_order_overdue
    return_amount = course_order.amount - insurance_amount
TypeError: unsupported operand type(s) for -: 'NoneType' and 'int'
[2018-09-18 17:58:00,003: INFO/MainProcess] Received task: boxing_console.tasks.refund_after_order_overdue[48f8b93e-7462-465a-b070-5f23e72b5bd3]  
[2018-09-18 17:58:00,004: DEBUG/MainProcess] TaskPool: Apply <function _fast_trace_task at 0x7fadec10d620> (args:('boxing_console.tasks.refund_after_order_overdue', '48f8b93e-7462-465a-b070-5f23e72b5bd3', {'lang': 'py', 'task': 'boxing_console.tasks.refund_after_order_overdue', 'id': '48f8b93e-7462-465a-b070-5f23e72b5bd3', 'shadow': None, 'eta': None, 'expires': None, 'group': None, 'retries': 0, 'timelimit': [None, None], 'root_id': '48f8b93e-7462-465a-b070-5f23e72b5bd3', 'parent_id': None, 'argsrepr': '()', 'kwargsrepr': '{}', 'origin': 'gen216@7b8d459fb4db', 'reply_to': '26979d60-d808-3d32-bcd7-c6f48a392674', 'correlation_id': '48f8b93e-7462-465a-b070-5f23e72b5bd3', 'delivery_info': {'exchange': '', 'routing_key': 'celery', 'priority': 0, 'redelivered': None}}, b'[[], {}, {"callbacks": null, "errbacks": null, "chain": null, "chord": null}]', 'application/json', 'utf-8') kwargs:{})
[2018-09-18 17:58:00,005: DEBUG/MainProcess] Task accepted: boxing_console.tasks.refund_after_order_overdue[48f8b93e-7462-465a-b070-5f23e72b5bd3] pid:250
[2018-09-18 17:58:00,015: INFO/MainProcess] Received task: boxing_console.tasks.order_tear_finished_after_boxer_confirmed[014b9b51-3467-44fe-bae8-7b8784cd0aed]  
[2018-09-18 17:58:00,016: DEBUG/MainProcess] TaskPool: Apply <function _fast_trace_task at 0x7fadec10d620> (args:('boxing_console.tasks.order_tear_finished_after_boxer_confirmed', '014b9b51-3467-44fe-bae8-7b8784cd0aed', {'lang': 'py', 'task': 'boxing_console.tasks.order_tear_finished_after_boxer_confirmed', 'id': '014b9b51-3467-44fe-bae8-7b8784cd0aed', 'shadow': None, 'eta': None, 'expires': None, 'group': None, 'retries': 0, 'timelimit': [None, None], 'root_id': '014b9b51-3467-44fe-bae8-7b8784cd0aed', 'parent_id': None, 'argsrepr': '()', 'kwargsrepr': '{}', 'origin': 'gen216@7b8d459fb4db', 'reply_to': '26979d60-d808-3d32-bcd7-c6f48a392674', 'correlation_id': '014b9b51-3467-44fe-bae8-7b8784cd0aed', 'delivery_info': {'exchange': '', 'routing_key': 'celery', 'priority': 0, 'redelivered': None}}, b'[[], {}, {"callbacks": null, "errbacks": null, "chain": null, "chord": null}]', 'application/json', 'utf-8') kwargs:{})
[2018-09-18 17:58:00,017: DEBUG/MainProcess] Task accepted: boxing_console.tasks.order_tear_finished_after_boxer_confirmed[014b9b51-3467-44fe-bae8-7b8784cd0aed] pid:249
[2018-09-18 17:58:00,018: WARNING/ForkPoolWorker-3] /usr/local/lib/python3.7/site-packages/django/db/models/fields/__init__.py:1423: RuntimeWarning: DateTimeField CourseOrder.boxer_confirm_time received a naive datetime (2018-09-18 17:53:00.017888) while time zone support is active.
  RuntimeWarning)
(0.002) SELECT `course_order`.`id`, `course_order`.`pay_order_id`, `course_order`.`boxer_id`, `course_order`.`user_id`, `course_order`.`club_id`, `course_order`.`course_id`, `course_order`.`course_name`, `course_order`.`course_price`, `course_order`.`course_duration`, `course_order`.`course_validity`, `course_order`.`order_number`, `course_order`.`status`, `course_order`.`order_time`, `course_order`.`pay_time`, `course_order`.`confirm_status`, `course_order`.`boxer_confirm_time`, `course_order`.`user_confirm_time`, `course_order`.`finish_time`, `course_order`.`amount`, `course_order`.`insurance_amount`, `course_order`.`refund_record_id`, `course_order`.`is_deleted` FROM `course_order` WHERE (`course_order`.`is_deleted` = 0 AND `course_order`.`boxer_confirm_time` < '2018-09-18 09:53:00.017888' AND `course_order`.`confirm_status` = 2) ORDER BY `course_order`.`order_time` DESC; args=(False, '2018-09-18 09:53:00.017888', 2)
[2018-09-18 17:58:00,022: DEBUG/ForkPoolWorker-3] (0.002) SELECT `course_order`.`id`, `course_order`.`pay_order_id`, `course_order`.`boxer_id`, `course_order`.`user_id`, `course_order`.`club_id`, `course_order`.`course_id`, `course_order`.`course_name`, `course_order`.`course_price`, `course_order`.`course_duration`, `course_order`.`course_validity`, `course_order`.`order_number`, `course_order`.`status`, `course_order`.`order_time`, `course_order`.`pay_time`, `course_order`.`confirm_status`, `course_order`.`boxer_confirm_time`, `course_order`.`user_confirm_time`, `course_order`.`finish_time`, `course_order`.`amount`, `course_order`.`insurance_amount`, `course_order`.`refund_record_id`, `course_order`.`is_deleted` FROM `course_order` WHERE (`course_order`.`is_deleted` = 0 AND `course_order`.`boxer_confirm_time` < '2018-09-18 09:53:00.017888' AND `course_order`.`confirm_status` = 2) ORDER BY `course_order`.`order_time` DESC; args=(False, '2018-09-18 09:53:00.017888', 2)
(0.001) SET SESSION TRANSACTION ISOLATION LEVEL READ COMMITTED; args=None
[2018-09-18 17:58:00,023: DEBUG/ForkPoolWorker-4] (0.001) SET SESSION TRANSACTION ISOLATION LEVEL READ COMMITTED; args=None
(0.002) SELECT `course`.`id`, `course`.`boxer_id`, `course`.`course_name`, `course`.`price`, `course`.`duration`, `course`.`validity`, `course`.`club_id`, `course`.`is_open`, `course`.`is_deleted` FROM `course` WHERE `course`.`id` = 15; args=(15,)
[2018-09-18 17:58:00,026: DEBUG/ForkPoolWorker-3] (0.002) SELECT `course`.`id`, `course`.`boxer_id`, `course`.`course_name`, `course`.`price`, `course`.`duration`, `course`.`validity`, `course`.`club_id`, `course`.`is_open`, `course`.`is_deleted` FROM `course` WHERE `course`.`id` = 15; args=(15,)
(0.003) SELECT `course_order`.`id`, `course_order`.`pay_order_id`, `course_order`.`boxer_id`, `course_order`.`user_id`, `course_order`.`club_id`, `course_order`.`course_id`, `course_order`.`course_name`, `course_order`.`course_price`, `course_order`.`course_duration`, `course_order`.`course_validity`, `course_order`.`order_number`, `course_order`.`status`, `course_order`.`order_time`, `course_order`.`pay_time`, `course_order`.`confirm_status`, `course_order`.`boxer_confirm_time`, `course_order`.`user_confirm_time`, `course_order`.`finish_time`, `course_order`.`amount`, `course_order`.`insurance_amount`, `course_order`.`refund_record_id`, `course_order`.`is_deleted` FROM `course_order` WHERE (`course_order`.`is_deleted` = 0 AND `course_order`.`course_validity` < '2018-09-18' AND `course_order`.`refund_record_id` IS NULL AND `course_order`.`status` = 5) ORDER BY `course_order`.`order_time` DESC; args=(False, '2018-09-18', 5)
[2018-09-18 17:58:00,027: DEBUG/ForkPoolWorker-4] (0.003) SELECT `course_order`.`id`, `course_order`.`pay_order_id`, `course_order`.`boxer_id`, `course_order`.`user_id`, `course_order`.`club_id`, `course_order`.`course_id`, `course_order`.`course_name`, `course_order`.`course_price`, `course_order`.`course_duration`, `course_order`.`course_validity`, `course_order`.`order_number`, `course_order`.`status`, `course_order`.`order_time`, `course_order`.`pay_time`, `course_order`.`confirm_status`, `course_order`.`boxer_confirm_time`, `course_order`.`user_confirm_time`, `course_order`.`finish_time`, `course_order`.`amount`, `course_order`.`insurance_amount`, `course_order`.`refund_record_id`, `course_order`.`is_deleted` FROM `course_order` WHERE (`course_order`.`is_deleted` = 0 AND `course_order`.`course_validity` < '2018-09-18' AND `course_order`.`refund_record_id` IS NULL AND `course_order`.`status` = 5) ORDER BY `course_order`.`order_time` DESC; args=(False, '2018-09-18', 5)
(0.001) SELECT `pay_order`.`id`, `pay_order`.`user_id`, `pay_order`.`content_type_id`, `pay_order`.`object_id`, `pay_order`.`status`, `pay_order`.`out_trade_no`, `pay_order`.`payment_type`, `pay_order`.`amount`, `pay_order`.`device`, `pay_order`.`order_time`, `pay_order`.`pay_time`, `pay_order`.`finish_time` FROM `pay_order` WHERE `pay_order`.`id` = 67; args=(67,)
[2018-09-18 17:58:00,029: DEBUG/ForkPoolWorker-3] (0.001) SELECT `pay_order`.`id`, `pay_order`.`user_id`, `pay_order`.`content_type_id`, `pay_order`.`object_id`, `pay_order`.`status`, `pay_order`.`out_trade_no`, `pay_order`.`payment_type`, `pay_order`.`amount`, `pay_order`.`device`, `pay_order`.`order_time`, `pay_order`.`pay_time`, `pay_order`.`finish_time` FROM `pay_order` WHERE `pay_order`.`id` = 67; args=(67,)
(0.001) SELECT `course_settle_order`.`id`, `course_settle_order`.`order_id`, `course_settle_order`.`course_id`, `course_settle_order`.`course_order_id`, `course_settle_order`.`created_time`, `course_settle_order`.`settled`, `course_settle_order`.`settled_date`, `course_settle_order`.`settled_amount` FROM `course_settle_order` WHERE (`course_settle_order`.`course_id` = 15 AND `course_settle_order`.`course_order_id` = 36 AND `course_settle_order`.`order_id` = 67); args=(15, 36, 67)
[2018-09-18 17:58:00,032: DEBUG/ForkPoolWorker-3] (0.001) SELECT `course_settle_order`.`id`, `course_settle_order`.`order_id`, `course_settle_order`.`course_id`, `course_settle_order`.`course_order_id`, `course_settle_order`.`created_time`, `course_settle_order`.`settled`, `course_settle_order`.`settled_date`, `course_settle_order`.`settled_amount` FROM `course_settle_order` WHERE (`course_settle_order`.`course_id` = 15 AND `course_settle_order`.`course_order_id` = 36 AND `course_settle_order`.`order_id` = 67); args=(15, 36, 67)
(0.001) SELECT `course`.`id`, `course`.`boxer_id`, `course`.`course_name`, `course`.`price`, `course`.`duration`, `course`.`validity`, `course`.`club_id`, `course`.`is_open`, `course`.`is_deleted` FROM `course` WHERE `course`.`id` = 15; args=(15,)
[2018-09-18 17:58:00,034: DEBUG/ForkPoolWorker-3] (0.001) SELECT `course`.`id`, `course`.`boxer_id`, `course`.`course_name`, `course`.`price`, `course`.`duration`, `course`.`validity`, `course`.`club_id`, `course`.`is_open`, `course`.`is_deleted` FROM `course` WHERE `course`.`id` = 15; args=(15,)
(0.001) SELECT `pay_order`.`id`, `pay_order`.`user_id`, `pay_order`.`content_type_id`, `pay_order`.`object_id`, `pay_order`.`status`, `pay_order`.`out_trade_no`, `pay_order`.`payment_type`, `pay_order`.`amount`, `pay_order`.`device`, `pay_order`.`order_time`, `pay_order`.`pay_time`, `pay_order`.`finish_time` FROM `pay_order` WHERE `pay_order`.`id` = 15; args=(15,)
[2018-09-18 17:58:00,036: DEBUG/ForkPoolWorker-3] (0.001) SELECT `pay_order`.`id`, `pay_order`.`user_id`, `pay_order`.`content_type_id`, `pay_order`.`object_id`, `pay_order`.`status`, `pay_order`.`out_trade_no`, `pay_order`.`payment_type`, `pay_order`.`amount`, `pay_order`.`device`, `pay_order`.`order_time`, `pay_order`.`pay_time`, `pay_order`.`finish_time` FROM `pay_order` WHERE `pay_order`.`id` = 15; args=(15,)
[2018-09-18 17:58:00,037: DEBUG/ForkPoolWorker-4] Sending message of length 2930 to http://39.104.180.65/api/2/store/
(0.001) SELECT `course_settle_order`.`id`, `course_settle_order`.`order_id`, `course_settle_order`.`course_id`, `course_settle_order`.`course_order_id`, `course_settle_order`.`created_time`, `course_settle_order`.`settled`, `course_settle_order`.`settled_date`, `course_settle_order`.`settled_amount` FROM `course_settle_order` WHERE (`course_settle_order`.`course_id` = 15 AND `course_settle_order`.`course_order_id` = 8 AND `course_settle_order`.`order_id` = 15); args=(15, 8, 15)
[2018-09-18 17:58:00,039: DEBUG/ForkPoolWorker-3] (0.001) SELECT `course_settle_order`.`id`, `course_settle_order`.`order_id`, `course_settle_order`.`course_id`, `course_settle_order`.`course_order_id`, `course_settle_order`.`created_time`, `course_settle_order`.`settled`, `course_settle_order`.`settled_date`, `course_settle_order`.`settled_amount` FROM `course_settle_order` WHERE (`course_settle_order`.`course_id` = 15 AND `course_settle_order`.`course_order_id` = 8 AND `course_settle_order`.`order_id` = 15); args=(15, 8, 15)
[2018-09-18 17:58:00,037: ERROR/ForkPoolWorker-4] Task boxing_console.tasks.refund_after_order_overdue[48f8b93e-7462-465a-b070-5f23e72b5bd3] raised unexpected: TypeError("unsupported operand type(s) for -: 'NoneType' and 'int'")
Traceback (most recent call last):
  File "/usr/local/lib/python3.7/site-packages/celery/app/trace.py", line 382, in trace_task
    R = retval = fun(*args, **kwargs)
  File "/usr/local/lib/python3.7/site-packages/celery/app/trace.py", line 641, in __protected_call__
    return self.run(*args, **kwargs)
  File "/work/boxing_console/tasks.py", line 52, in refund_after_order_overdue
    return_amount = course_order.amount - insurance_amount
TypeError: unsupported operand type(s) for -: 'NoneType' and 'int'
(0.001) UPDATE `course_order` SET `status` = 3 WHERE (`course_order`.`is_deleted` = 0 AND `course_order`.`boxer_confirm_time` < '2018-09-18 09:53:00.017888' AND `course_order`.`confirm_status` = 2); args=(3, False, '2018-09-18 09:53:00.017888', 2)
[2018-09-18 17:58:00,041: DEBUG/ForkPoolWorker-3] (0.001) UPDATE `course_order` SET `status` = 3 WHERE (`course_order`.`is_deleted` = 0 AND `course_order`.`boxer_confirm_time` < '2018-09-18 09:53:00.017888' AND `course_order`.`confirm_status` = 2); args=(3, False, '2018-09-18 09:53:00.017888', 2)
[2018-09-18 17:58:00,044: INFO/ForkPoolWorker-3] Task boxing_console.tasks.order_tear_finished_after_boxer_confirmed[014b9b51-3467-44fe-bae8-7b8784cd0aed] succeeded in 0.026723408001998905s: None
[2018-09-18 17:59:00,010: INFO/MainProcess] Received task: boxing_console.tasks.set_course_overdue[6d50555c-b1e7-4355-9b17-42ffe17c259f]  
[2018-09-18 17:59:00,010: DEBUG/MainProcess] TaskPool: Apply <function _fast_trace_task at 0x7fadec10d620> (args:('boxing_console.tasks.set_course_overdue', '6d50555c-b1e7-4355-9b17-42ffe17c259f', {'lang': 'py', 'task': 'boxing_console.tasks.set_course_overdue', 'id': '6d50555c-b1e7-4355-9b17-42ffe17c259f', 'shadow': None, 'eta': None, 'expires': None, 'group': None, 'retries': 0, 'timelimit': [None, None], 'root_id': '6d50555c-b1e7-4355-9b17-42ffe17c259f', 'parent_id': None, 'argsrepr': '()', 'kwargsrepr': '{}', 'origin': 'gen216@7b8d459fb4db', 'reply_to': '26979d60-d808-3d32-bcd7-c6f48a392674', 'correlation_id': '6d50555c-b1e7-4355-9b17-42ffe17c259f', 'delivery_info': {'exchange': '', 'routing_key': 'celery', 'priority': 0, 'redelivered': None}}, b'[[], {}, {"callbacks": null, "errbacks": null, "chain": null, "chord": null}]', 'application/json', 'utf-8') kwargs:{})
[2018-09-18 17:59:00,012: DEBUG/MainProcess] Task accepted: boxing_console.tasks.set_course_overdue[6d50555c-b1e7-4355-9b17-42ffe17c259f] pid:250
(0.001) UPDATE `course` SET `is_open` = 0 WHERE (`course`.`is_deleted` = 0 AND `course`.`validity` < '2018-09-18'); args=(False, False, '2018-09-18')
[2018-09-18 17:59:00,015: DEBUG/ForkPoolWorker-4] (0.001) UPDATE `course` SET `is_open` = 0 WHERE (`course`.`is_deleted` = 0 AND `course`.`validity` < '2018-09-18'); args=(False, False, '2018-09-18')
[2018-09-18 17:59:00,020: INFO/ForkPoolWorker-4] Task boxing_console.tasks.set_course_overdue[6d50555c-b1e7-4355-9b17-42ffe17c259f] succeeded in 0.008743811999011086s: None
[2018-09-18 18:00:00,010: INFO/MainProcess] Received task: boxing_console.tasks.set_course_overdue[ee33e518-ea86-483c-962b-a13a6e8af5a4]  
[2018-09-18 18:00:00,010: DEBUG/MainProcess] TaskPool: Apply <function _fast_trace_task at 0x7fadec10d620> (args:('boxing_console.tasks.set_course_overdue', 'ee33e518-ea86-483c-962b-a13a6e8af5a4', {'lang': 'py', 'task': 'boxing_console.tasks.set_course_overdue', 'id': 'ee33e518-ea86-483c-962b-a13a6e8af5a4', 'shadow': None, 'eta': None, 'expires': None, 'group': None, 'retries': 0, 'timelimit': [None, None], 'root_id': 'ee33e518-ea86-483c-962b-a13a6e8af5a4', 'parent_id': None, 'argsrepr': '()', 'kwargsrepr': '{}', 'origin': 'gen216@7b8d459fb4db', 'reply_to': '26979d60-d808-3d32-bcd7-c6f48a392674', 'correlation_id': 'ee33e518-ea86-483c-962b-a13a6e8af5a4', 'delivery_info': {'exchange': '', 'routing_key': 'celery', 'priority': 0, 'redelivered': None}}, b'[[], {}, {"callbacks": null, "errbacks": null, "chain": null, "chord": null}]', 'application/json', 'utf-8') kwargs:{})
[2018-09-18 18:00:00,013: DEBUG/MainProcess] Task accepted: boxing_console.tasks.set_course_overdue[ee33e518-ea86-483c-962b-a13a6e8af5a4] pid:249
(0.002) SET SESSION TRANSACTION ISOLATION LEVEL READ COMMITTED; args=None
[2018-09-18 18:00:00,019: DEBUG/ForkPoolWorker-3] (0.002) SET SESSION TRANSACTION ISOLATION LEVEL READ COMMITTED; args=None
(0.002) UPDATE `course` SET `is_open` = 0 WHERE (`course`.`is_deleted` = 0 AND `course`.`validity` < '2018-09-18'); args=(False, False, '2018-09-18')
[2018-09-18 18:00:00,024: DEBUG/ForkPoolWorker-3] (0.002) UPDATE `course` SET `is_open` = 0 WHERE (`course`.`is_deleted` = 0 AND `course`.`validity` < '2018-09-18'); args=(False, False, '2018-09-18')
[2018-09-18 18:00:00,031: INFO/ForkPoolWorker-3] Task boxing_console.tasks.set_course_overdue[ee33e518-ea86-483c-962b-a13a6e8af5a4] succeeded in 0.01945382100166171s: None
[2018-09-18 18:00:02,259: INFO/MainProcess] Received task: boxing_app.tasks.incr_hot_video_views_count[b2095292-645e-446e-b673-a47ef47eab02]  
[2018-09-18 18:00:02,259: DEBUG/MainProcess] TaskPool: Apply <function _fast_trace_task at 0x7fadec10d620> (args:('boxing_app.tasks.incr_hot_video_views_count', 'b2095292-645e-446e-b673-a47ef47eab02', {'lang': 'py', 'task': 'boxing_app.tasks.incr_hot_video_views_count', 'id': 'b2095292-645e-446e-b673-a47ef47eab02', 'shadow': None, 'eta': None, 'expires': None, 'group': None, 'retries': 0, 'timelimit': [None, None], 'root_id': 'b2095292-645e-446e-b673-a47ef47eab02', 'parent_id': None, 'argsrepr': '(3,)', 'kwargsrepr': '{}', 'origin': 'gen55516@ningleideMacBook-Pro.local', 'reply_to': '9fe6c38b-dc1c-32cc-9db7-3551206697e4', 'correlation_id': 'b2095292-645e-446e-b673-a47ef47eab02', 'delivery_info': {'exchange': '', 'routing_key': 'celery', 'priority': 0, 'redelivered': None}}, b'[[3], {}, {"callbacks": null, "errbacks": null, "chain": null, "chord": null}]', 'application/json', 'utf-8') kwargs:{})
[2018-09-18 18:00:02,261: DEBUG/MainProcess] Task accepted: boxing_app.tasks.incr_hot_video_views_count[b2095292-645e-446e-b673-a47ef47eab02] pid:250
(0.001) SET SESSION TRANSACTION ISOLATION LEVEL READ COMMITTED; args=None
[2018-09-18 18:00:02,266: DEBUG/ForkPoolWorker-4] (0.001) SET SESSION TRANSACTION ISOLATION LEVEL READ COMMITTED; args=None
(0.001) UPDATE `hot_video` SET `views_count` = (`hot_video`.`views_count` + 1) WHERE `hot_video`.`id` = 3; args=(1, 3)
[2018-09-18 18:00:02,268: DEBUG/ForkPoolWorker-4] (0.001) UPDATE `hot_video` SET `views_count` = (`hot_video`.`views_count` + 1) WHERE `hot_video`.`id` = 3; args=(1, 3)
[2018-09-18 18:00:02,269: INFO/ForkPoolWorker-4] Task boxing_app.tasks.incr_hot_video_views_count[b2095292-645e-446e-b673-a47ef47eab02] succeeded in 0.008442689999355935s: None
[2018-09-18 18:00:03,464: INFO/MainProcess] Received task: boxing_app.tasks.set_hot_video_like_count[bd1b4337-3064-4e7d-a361-0f44e7609b50]  
[2018-09-18 18:00:03,465: DEBUG/MainProcess] TaskPool: Apply <function _fast_trace_task at 0x7fadec10d620> (args:('boxing_app.tasks.set_hot_video_like_count', 'bd1b4337-3064-4e7d-a361-0f44e7609b50', {'lang': 'py', 'task': 'boxing_app.tasks.set_hot_video_like_count', 'id': 'bd1b4337-3064-4e7d-a361-0f44e7609b50', 'shadow': None, 'eta': None, 'expires': None, 'group': None, 'retries': 0, 'timelimit': [None, None], 'root_id': 'bd1b4337-3064-4e7d-a361-0f44e7609b50', 'parent_id': None, 'argsrepr': '(7, 1)', 'kwargsrepr': '{}', 'origin': 'gen55516@ningleideMacBook-Pro.local', 'reply_to': '9fe6c38b-dc1c-32cc-9db7-3551206697e4', 'correlation_id': 'bd1b4337-3064-4e7d-a361-0f44e7609b50', 'delivery_info': {'exchange': '', 'routing_key': 'celery', 'priority': 0, 'redelivered': None}}, b'[[7, 1], {}, {"callbacks": null, "errbacks": null, "chain": null, "chord": null}]', 'application/json', 'utf-8') kwargs:{})
[2018-09-18 18:00:03,466: DEBUG/MainProcess] Task accepted: boxing_app.tasks.set_hot_video_like_count[bd1b4337-3064-4e7d-a361-0f44e7609b50] pid:249
(0.001) UPDATE `hot_video` SET `like_count` = 1 WHERE `hot_video`.`id` = 7; args=(1, 7)
[2018-09-18 18:00:03,467: DEBUG/ForkPoolWorker-3] (0.001) UPDATE `hot_video` SET `like_count` = 1 WHERE `hot_video`.`id` = 7; args=(1, 7)
[2018-09-18 18:00:03,469: INFO/ForkPoolWorker-3] Task boxing_app.tasks.set_hot_video_like_count[bd1b4337-3064-4e7d-a361-0f44e7609b50] succeeded in 0.0034419719995639753s: None
[2018-09-18 18:00:08,272: INFO/MainProcess] Received task: boxing_app.tasks.register_easemob_account[713c09c8-dbe0-4e24-8ea0-4b184c6b1256]  
[2018-09-18 18:00:08,273: DEBUG/MainProcess] TaskPool: Apply <function _fast_trace_task at 0x7fadec10d620> (args:('boxing_app.tasks.register_easemob_account', '713c09c8-dbe0-4e24-8ea0-4b184c6b1256', {'lang': 'py', 'task': 'boxing_app.tasks.register_easemob_account', 'id': '713c09c8-dbe0-4e24-8ea0-4b184c6b1256', 'shadow': None, 'eta': None, 'expires': None, 'group': None, 'retries': 0, 'timelimit': [None, None], 'root_id': '713c09c8-dbe0-4e24-8ea0-4b184c6b1256', 'parent_id': None, 'argsrepr': '(162,)', 'kwargsrepr': '{}', 'origin': 'gen55516@ningleideMacBook-Pro.local', 'reply_to': '9fe6c38b-dc1c-32cc-9db7-3551206697e4', 'correlation_id': '713c09c8-dbe0-4e24-8ea0-4b184c6b1256', 'delivery_info': {'exchange': '', 'routing_key': 'celery', 'priority': 0, 'redelivered': None}}, b'[[162], {}, {"callbacks": null, "errbacks": null, "chain": null, "chord": null}]', 'application/json', 'utf-8') kwargs:{})
[2018-09-18 18:00:08,275: DEBUG/MainProcess] Task accepted: boxing_app.tasks.register_easemob_account[713c09c8-dbe0-4e24-8ea0-4b184c6b1256] pid:250
[2018-09-18 18:00:08,276: DEBUG/ForkPoolWorker-4] Starting new HTTPS connection (1): a1.easemob.com:443
[2018-09-18 18:00:08,347: DEBUG/ForkPoolWorker-4] https://a1.easemob.com:443 "POST /douqu/boxing-test/users HTTP/1.1" 429 None
[2018-09-18 18:00:08,353: DEBUG/ForkPoolWorker-4] Starting new HTTPS connection (1): a1.easemob.com:443
[2018-09-18 18:00:08,413: DEBUG/ForkPoolWorker-4] https://a1.easemob.com:443 "POST /douqu/boxing-test/messages HTTP/1.1" 200 None
[2018-09-18 18:00:08,416: INFO/ForkPoolWorker-4] Task boxing_app.tasks.register_easemob_account[713c09c8-dbe0-4e24-8ea0-4b184c6b1256] succeeded in 0.14183863699872745s: <Response [200]>
